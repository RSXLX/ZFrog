---
status: 已审核
version: 1.2
last_updated: 2026-01-14
reviewer: 用户
---

# 旅行系统优化 v2.0 需求设计

> 社交增强、链上探索和跨链策略博弈功能设计。

---

## 一、需求背景

1. **好友联动**：从"陪跑"到"共赢"
2. **本地旅行**：引入"链上先驱者"奖励
3. **跨链旅行**：从"换个场景"到"生态套利"

---

## 二、功能需求总表

### 2.1 好友联动功能

| # | 功能 | 优先级 | 描述 |
|---|------|--------|------|
| F1 | 友情值系统 | P0 | 结伴旅行自动增加友情等级（1-10级） |
| F2 | 双人纪念品 | P1 | 高友情值解锁"双人合影"纪念品 |
| F3 | 投喂机制 | P0 | 好友可投喂减少 10% 剩余时间 |
| F3.1 | 投喂偏好系统 | P1 | 投喂偏好零食触发"幸运爆发"Buff (+20% 稀有度) |
| F3.2 | 偏好动态变化 | P1 | 零食偏好随目标链/季节变化（如 ETH 链爱"以太糖果"） |
| F4 | 投喂积分 | P1 | 投喂者获得积分奖励 |

### 2.2 链上探索功能

| # | 功能 | 优先级 | 描述 |
|---|------|--------|------|
| F5 | 地址类型分析 | P0 | 识别普通/合约/DeFi/巨鲸地址 |
| F6 | 探索加成 | P0 | 不同地址类型给予 XP/纪念品概率加成 |
| F6.1 | 探索脚印 | P1 | DeFi 协议生成社交分享卡片 |
| F6.2 | 首位发现者 | P1 | 首个探索热门地址获 Gold Label NFT |
| F7 | 碎片系统 | P2 | 巨鲸/DeFi 地址可获资产碎片 NFT |

### 2.3 跨链策略功能

| # | 功能 | 优先级 | 描述 |
|---|------|--------|------|
| F8 | 链专属特产 | P0 | 纪念品具有链独特材料属性 |
| F9 | 特产合成 | P1 | 收集多链特产合成"全链大师勋章" |
| F10 | 跨链迷路事件 | P2 | 5% 概率触发，需好友救援 |
| F11 | 救援机制 | P2 | 好友支付 Gas 救援，分享 30% 收益 |
| F11.1 | 公共救援中心 | P2 | 4 小时超时后公开至"青蛙救援广场" |
| F11.2 | 救援信誉分 | P2 | 高信誉者可接高收益任务，防脚本抢救 |

### 2.4 系统增强

| # | 功能 | 优先级 | 描述 |
|---|------|--------|------|
| F12 | INTERACTING 状态 | P1 | 新增旅行阶段触发社交事件 |
| F13 | AI 日记增强 | P0 | 日记包含好友投喂和互动描述 |

---

## 三、核心用户场景

### 3.1 投喂好友青蛙 (P0)
B 投喂 A 的旅行青蛙 → 消耗 10 积分减少 10% 时间 → 双方友情值 +1

### 3.2 投喂偏好系统 (P1)
青蛙在 ETH 链旅行时偏好"以太糖果" → 投喂该零食减少 15% 时间 → 获得"幸运爆发"Buff

### 3.3 首位发现者 (P1)
首个探索 Uniswap Router 地址 → 获得 Gold Label 探索脚印 NFT → 可在社区展示/交易

### 3.4 公共救援 (P2)
青蛙迷路 4h 后无好友救援 → 公开至救援广场 → 陌生人救援获 20% 收益 + 10 信誉分

---

## 四、数据结构扩展

### Friendship 扩展
```
affinityLevel, groupTravelCount, lastTravelTogether
```

### Frog 偏好扩展
```
snackPreference, currentChainPreference, luckyBuff, luckyBuffExpiry
```

### 新增 TravelFeed
```
travelId, feederId, feedType, isPreferred, pointsCost, timeReduced
```

### 新增 AddressDiscovery (首位发现者)
```
address, chainId, discovererFrogId, discoveredAt, isGoldLabel
```

### 新增 RescueRequest (P2)
```
travelId, frogId, chainId, isPublic, rescuerId, rescuerReputation
```

### TravelStage 扩展
```
DEPARTING, CROSSING, ARRIVING, EXPLORING, INTERACTING, STRANDED, RETURNING
```

---

## 五、接口依赖

| 接口 | 方法 | 优先级 |
|------|------|--------|
| `/api/travel/:id/feed` | POST | P0 |
| `/api/address/analyze` | GET | P0 |
| `/api/travel/:id/share` | GET | P1 |
| `/api/address/:address/discovery` | GET | P1 |
| `/api/rescue/public` | GET | P2 |
| `/api/travel/:id/rescue` | POST | P2 |

---

## 六、验收标准

### P0 阶段
- [ ] 友情值系统
- [ ] 投喂机制
- [ ] 地址类型分析
- [ ] 探索加成
- [ ] AI 日记增强
- [ ] 链专属特产

### P1 阶段
- [ ] 投喂偏好系统 + 偏好动态变化
- [ ] 探索脚印社交分享
- [ ] 首位发现者 Gold Label
- [ ] 双人纪念品 + 特产合成

### P2 阶段
- [ ] 跨链迷路事件
- [ ] 救援机制 + 公共救援中心
- [ ] 救援信誉分
- [ ] 碎片系统

---

## 七、变更记录

| 日期 | 版本 | 内容 |
|------|------|------|
| 2026-01-14 | 1.0 | 初始需求设计 |
| 2026-01-14 | 1.1 | 新增投喂偏好、探索脚印、公共救援 |
| 2026-01-14 | 1.2 | 新增救援信誉分、偏好动态变化、首位发现者 |

---
