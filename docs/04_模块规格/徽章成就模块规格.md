---
status: 已审核
version: 1.0
last_updated: 2026-01-14
reviewer: AI (根据实际代码检查)
---

# 徽章成就模块规格

> 本文档定义徽章成就模块的技术规格和实现约定。

---

## 一、模块概述

徽章成就系统激励玩家完成各种游戏目标，通过收集徽章展示成就。

| 属性 | 值 |
|------|------|
| 模块名称 | 徽章成就系统 (Badge System) |
| 依赖模块 | 旅行系统、好友系统、家园系统 |
| 技术栈 | Node.js + TypeScript + Prisma |

---

## 二、核心功能

### 2.1 徽章管理

| 功能点 | 说明 | 优先级 | 状态 |
|--------|------|--------|------|
| 徽章定义 | TravelBadge 表存储徽章模板 | P0 | ✅ 已实现 |
| 解锁检查 | 自动检查解锁条件 | P0 | ✅ 已实现 |
| 徽章授予 | 创建 UserBadge 记录 | P0 | ✅ 已实现 |
| 进度追踪 | 统计已获得/总数 | P1 | ✅ 已实现 |

### 2.2 解锁类型

| 类型 | 说明 | 状态 |
|------|------|------|
| TRIP_COUNT | 旅行次数达标 | ✅ |
| CHAIN_VISIT | 访问特定链 | ✅ |
| MULTI_CHAIN | 多链旅行 | ✅ |
| RARE_FIND | 稀有发现 | ✅ |
| SOCIAL | 社交互动 | ✅ |
| COLLECTION | 收藏成就 | ✅ |

---

## 三、预定义徽章

### 3.1 旅行次数徽章

| 代码 | 名称 | 条件 | 图标 | 稀有度 |
|------|------|------|------|--------|
| FIRST_TRIP | 第一次出门 | 1 次旅行 | 🎒 | 1 |
| FREQUENT_TRAVELER | 常旅客 | 5 次旅行 | ✈️ | 2 |
| TRAVEL_ADDICT | 旅行上瘾 | 20 次旅行 | 🌍 | 3 |
| TRAVEL_MASTER | 旅行大师 | 50 次旅行 | 🏆 | 4 |

### 3.2 链访问徽章

| 代码 | 名称 | 条件 | 图标 | 稀有度 |
|------|------|------|------|--------|
| BSC_VISITOR | BSC 游客 | 访问 BSC 3 次 | 🟡 | 2 |
| ETH_VISITOR | 以太坊游客 | 访问 ETH 3 次 | 💎 | 2 |
| ZETA_VISITOR | ZetaChain 游客 | 访问 ZETA 3 次 | ⚡ | 2 |

### 3.3 多链徽章

| 代码 | 名称 | 条件 | 图标 | 稀有度 |
|------|------|------|------|--------|
| CHAIN_HOPPER | 链间旅行者 | 访问 2 条链 | 🌉 | 2 |
| OMNI_TRAVELER | 全链旅行家 | 访问所有链 | 🌈 | 3 |

### 3.4 发现徽章

| 代码 | 名称 | 条件 | 图标 | 稀有度 |
|------|------|------|------|--------|
| LUCKY_FINDER | 幸运儿 | 发现 4 星以上 | 🍀 | 3 |
| WHALE_WATCHER | 观鲸者 | 发现巨鲸钱包 | 🐋 | 4 |

---

## 四、数据规格

### 4.1 TravelBadge 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | String | 主键 CUID |
| code | String | 唯一代码 |
| name | String | 显示名称 |
| description | String | 描述文字 |
| icon | String | 图标 emoji |
| unlockType | BadgeUnlockType | 解锁类型 |
| unlockCondition | Json | 解锁条件配置 |
| rarity | Int | 稀有度 1-4 |
| isHidden | Boolean | 是否隐藏 |

### 4.2 UserBadge 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | String | 主键 CUID |
| frogId | Int | 青蛙 ID |
| badgeId | String | 徽章 ID |
| unlockedAt | DateTime | 解锁时间 |
| unlockedByTravelId | Int? | 触发旅行 ID |

---

## 五、接口约定

### 5.1 路由前缀

| 模块 | 前缀 |
|------|------|
| 徽章 | `/api/badges` |

### 5.2 响应格式

```typescript
interface BadgeResponse {
  success: boolean;
  data: Badge[] | BadgeStats;
  error?: string;
}
```

---

## 六、解锁条件配置

### 6.1 条件 JSON 结构

```typescript
// TRIP_COUNT
interface TripCountCondition {
  threshold: number;
}

// CHAIN_VISIT
interface ChainVisitCondition {
  chain: 'BSC_TESTNET' | 'ETH_SEPOLIA' | 'ZETACHAIN_ATHENS';
  threshold: number;
}

// MULTI_CHAIN
interface MultiChainCondition {
  threshold: number;
}

// RARE_FIND
interface RareFindCondition {
  minRarity: number;
}

// SOCIAL
interface SocialCondition {
  metric: 'friend_count' | 'message_count' | 'gift_sent';
  threshold: number;
}

// COLLECTION
interface CollectionCondition {
  metric: 'souvenir_count' | 'photo_count' | 'decoration_placed';
  threshold: number;
}
```

---

## 七、性能要求

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 徽章列表响应 | < 200ms | 缓存可用 |
| 解锁检查延迟 | < 500ms | 含数据库查询 |
| 批量检查 | < 1s | 所有徽章检查 |

---

## 八、代码实现

### 8.1 后端文件

| 文件 | 行数 | 说明 |
|------|------|------|
| `badge.routes.ts` | 206 | API 路由 |
| `badge.service.ts` | 208 | 核心服务 |
| `badge-checker.service.ts` | - | 条件检查 |
| `achievement.service.ts` | - | 成就服务 |

### 8.2 前端组件

| 组件 | 说明 |
|------|------|
| `BadgesPage.tsx` | 徽章展示页面 (18KB) |

---

## 九、变更记录

| 日期 | 版本 | 内容 |
|------|------|------|
| 2026-01-14 | 1.0 | 初始模块规格 |

---
