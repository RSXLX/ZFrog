---
status: 草稿
version: 1.0
last_updated: 2026-01-13
reviewer: 用户
---

# 设计模式与最佳实践

> 本文档记录项目中沉淀的设计模式和最佳实践。

## 变更记录

| 日期 | 变更内容 |
|------|----------|
| 2026-01-13 | 初始化设计模式文档 |

---

## 一、前端设计模式

### 1.1 API 调用模式

**模式**：统一 API 模块 + 类型安全

```typescript
// api/index.ts
import axios from 'axios';

const api = axios.create({
  baseURL: '/api/v1',
  timeout: 10000,
});

// 泛型响应类型
export async function get<T>(url: string): Promise<T> {
  const { data } = await api.get<T>(url);
  return data;
}
```

---

### 1.2 状态管理模式

**模式**：Zustand + React Query 组合

- Zustand：管理客户端状态（UI 状态、用户偏好）
- React Query：管理服务端状态（API 数据缓存、同步）

---

## 二、后端设计模式

### 2.1 路由分层模式

**模式**：Controller → Service → Repository

```
routes/        # 路由定义，处理 HTTP 请求/响应
services/      # 业务逻辑
repositories/  # 数据访问
```

---

### 2.2 错误处理模式

**模式**：统一错误类 + 错误中间件

```typescript
// 自定义错误类
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public code: string
  ) {
    super(message);
  }
}

// 错误中间件统一处理
```

---

## 三、智能合约设计模式

### 3.1 可升级合约模式

**模式**：UUPS Proxy + Initializable

- 使用 OpenZeppelin 的 UUPS 代理模式
- 分离存储和逻辑合约
- 详见 `docs/upgradeable-contracts-guide.md`

---

### 3.2 事件驱动模式

**模式**：事件发射 + 链下监听

```solidity
event TravelStarted(uint256 indexed tokenId, uint256 chainId);
event TravelCompleted(uint256 indexed tokenId, bytes32 journalHash);
```

---

## 四、桌面端设计模式

### 4.1 MVC 分离模式

**模式**：界面 / 逻辑 / 数据分离

```
ui/            # 界面组件
controllers/   # 业务逻辑
models/        # 数据模型
```

---

### 4.2 信号槽通信模式

**模式**：PyQt 信号槽解耦组件通信

```python
# 定义信号
wallet_connected = pyqtSignal(str)

# 连接槽函数
self.wallet_connected.connect(self.on_wallet_connected)
```

---

## 五、通用最佳实践

### 5.1 配置管理

- 环境变量分离（开发/测试/生产）
- 敏感信息不入库
- 使用 `.env.example` 作为模板

### 5.2 日志规范

- 结构化日志格式
- 区分日志级别（debug/info/warn/error）
- 关键操作记录审计日志

### 5.3 测试策略

- 单元测试覆盖核心逻辑
- 集成测试验证模块交互
- E2E 测试验证关键流程

---
