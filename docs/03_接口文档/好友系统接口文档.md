---
status: 已审核
version: 1.0
last_updated: 2026-01-14
reviewer: AI (根据实际代码检查)
---

# 好友系统接口文档

## 一、接口概览

| 分类 | 接口 | 方法 | 路径 |
|------|------|------|------|
| 请求 | 发送好友请求 | POST | `/api/friends/request` |
| 请求 | 响应好友请求 | PUT | `/api/friends/request/:id/respond` |
| 列表 | 获取好友列表 | GET | `/api/friends/list/:frogId` |
| 列表 | 获取请求列表 | GET | `/api/friends/requests/:frogId` |
| 管理 | 删除好友 | DELETE | `/api/friends/:friendshipId` |
| 互动 | 创建互动 | POST | `/api/friends/:friendshipId/interact` |
| 互动 | 获取互动历史 | GET | `/api/friends/:friendshipId/interactions` |

---

## 二、好友请求接口

### 2.1 发送好友请求

```
POST /api/friends/request
```

**请求体**

```json
{
  "requesterId": 1,
  "addresseeId": 2,
  "walletAddress": "0x..."
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| requesterId | number | 是 | 发起者 TokenId |
| addresseeId | number | 否 | 接收者 TokenId |
| walletAddress | string | 否 | 接收者钱包地址 (二选一) |

> 注：`addresseeId` 和 `walletAddress` 至少提供一个

**响应**

```json
{
  "id": 1,
  "requesterId": 123,
  "addresseeId": 456,
  "status": "Pending",
  "createdAt": "2026-01-14T09:00:00.000Z",
  "requester": { ... },
  "addressee": { ... }
}
```

---

### 2.2 响应好友请求

```
PUT /api/friends/request/:id/respond
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | number | 是 | 好友关系 ID |

**请求体**

```json
{
  "status": "Accepted",
  "message": "很高兴认识你！"
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| status | string | 是 | `Accepted` 或 `Declined` |
| message | string | 否 | 接受时的留言 |

**响应**

```json
{
  "id": 1,
  "status": "Accepted",
  "requester": { ... },
  "addressee": { ... }
}
```

---

## 三、好友列表接口

### 3.1 获取好友列表

```
GET /api/friends/list/:frogId
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| frogId | number | 是 | 青蛙 TokenId |

**响应**

```json
[
  {
    "id": 123,
    "tokenId": 1,
    "name": "小蛙蛙",
    "ownerAddress": "0x...",
    "status": "Idle",
    "level": 5,
    "friendshipId": 1,
    "lastInteraction": {
      "type": "Message",
      "message": "Hello!",
      "createdAt": "2026-01-14T08:00:00.000Z"
    },
    "isOnline": true,
    "travels": [...]
  }
]
```

---

### 3.2 获取待处理请求

```
GET /api/friends/requests/:frogId
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| frogId | number | 是 | 青蛙 TokenId |

**响应**

```json
[
  {
    "id": 1,
    "requesterId": 123,
    "addresseeId": 456,
    "status": "Pending",
    "createdAt": "2026-01-14T08:00:00.000Z",
    "requester": {
      "id": 123,
      "tokenId": 1,
      "name": "小蛙",
      "travels": [...]
    }
  }
]
```

---

## 四、好友管理接口

### 4.1 删除好友

```
DELETE /api/friends/:friendshipId
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| friendshipId | number | 是 | 好友关系 ID |

**响应**

```json
{
  "success": true
}
```

---

## 五、互动接口

### 5.1 创建互动

```
POST /api/friends/:friendshipId/interact
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| friendshipId | number | 是 | 好友关系 ID |

**请求体**

```json
{
  "actorId": 123,
  "type": "Message",
  "message": "你好！",
  "metadata": {}
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| actorId | number | 是 | 执行者数据库 ID |
| type | string | 是 | 互动类型 |
| message | string | 否 | 互动消息 |
| metadata | object | 否 | 附加数据 |

**互动类型**

| type | 说明 |
|------|------|
| Visit | 访问 |
| Feed | 喂食 |
| Play | 玩耍 |
| Gift | 送礼 |
| Message | 消息 |
| Travel | 结伴旅行 |

**响应**

```json
{
  "id": 1,
  "friendshipId": 1,
  "actorId": 123,
  "type": "Message",
  "message": "你好！",
  "createdAt": "2026-01-14T09:00:00.000Z",
  "actor": { ... },
  "friendship": { ... }
}
```

---

### 5.2 获取互动历史

```
GET /api/friends/:friendshipId/interactions?limit=20&offset=0
```

**查询参数**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| limit | number | 否 | 每页数量，默认 20 |
| offset | number | 否 | 偏移量，默认 0 |

**响应**

```json
[
  {
    "id": 1,
    "type": "Message",
    "message": "你好！",
    "createdAt": "2026-01-14T09:00:00.000Z",
    "actor": {
      "id": 123,
      "name": "小蛙"
    }
  }
]
```

---

## 六、WebSocket 事件

| 事件 | 参数 | 说明 |
|------|------|------|
| `friend:request:received` | `{ friendship }` | 收到好友请求 |
| `friend:request:status` | `{ status, requesterId, addresseeId }` | 请求状态变更 |
| `friend:interaction` | `{ friendshipId, actorId, targetId, interaction }` | 新互动 |
| `friend:removed` | `{ requesterId, addresseeId }` | 好友删除 |

---

## 七、错误码

| HTTP | 说明 |
|------|------|
| 400 | 参数错误 / 不能加自己 / 已是好友 |
| 403 | 无权操作此好友关系 |
| 404 | 青蛙不存在 / 好友关系不存在 |
| 500 | 服务器内部错误 |

---

## 八、变更记录

| 日期 | 内容 |
|------|------|
| 2026-01-14 | 初始版本 |
