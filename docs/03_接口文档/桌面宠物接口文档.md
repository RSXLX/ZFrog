---
status: 已审核
version: 1.0
last_updated: 2026-01-14
reviewer: AI (根据实际代码检查)
---

# 桌面宠物接口文档

> 桌面宠物是 Python 客户端应用，本文档描述其与后端API的交互接口。

## 一、通信方式

| 方式 | 用途 | 协议 |
|------|------|------|
| REST API | 数据获取/操作 | HTTP |
| WebSocket | 实时推送 | WS |
| WalletConnect | 钱包交互 | WC v2 |

---

## 二、核心接口

桌面宠物使用以下后端 API（已在其他模块文档中定义）：

### 2.1 青蛙接口

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取我的青蛙 | GET | `/api/frogs/my/:address` | 获取钱包青蛙 |
| 获取青蛙详情 | GET | `/api/frogs/:tokenId` | 获取详细信息 |

### 2.2 旅行接口

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 发起旅行 | POST | `/api/travel/start` | 开始新旅行 |
| 获取旅行状态 | GET | `/api/travel/:travelId` | 查询旅行状态 |
| 活跃旅行列表 | GET | `/api/travel/active/:frogId` | 当前活跃旅行 |

### 2.3 跨链接口

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 支持的链 | GET | `/api/v1/cross-chain/supported-chains` | 获取支持链列表 |
| 资格检查 | GET | `/api/v1/cross-chain/can-travel/:tokenId` | 检查跨链资格 |
| 发起跨链 | POST | `/api/v1/cross-chain/travel` | 创建跨链旅行 |

---

## 三、WebSocket 事件

桌面宠物监听以下 WebSocket 事件：

| 事件 | 说明 | 处理 |
|------|------|------|
| `travel:started` | 旅行开始 | 播放出发动画 |
| `travel:completed` | 旅行完成 | 播放返回动画，显示奖励 |
| `badge:unlocked` | 徽章解锁 | 显示解锁通知 |
| `friend:request:received` | 好友请求 | 显示好友请求通知 |
| `gift:received` | 收到礼物 | 显示礼物通知 |

---

## 四、WalletConnect 交互

### 4.1 连接流程

```python
# 1. 初始化 WalletConnect
wc = WalletConnect(project_id="xxx")

# 2. 创建会话，获取URI
uri = await wc.create_session()

# 3. 显示二维码让用户扫描
show_qr_code(uri)

# 4. 等待连接
address = await wc.wait_for_connection()
```

### 4.2 签名请求

```python
# 请求签名
message = "Login to ZetaFrog"
signature = await wc.sign_message(address, message)

# 发送交易
tx = {
    "to": contract_address,
    "data": encoded_data,
    "value": "0x0"
}
tx_hash = await wc.send_transaction(tx)
```

---

## 五、本地API

桌面宠物内部服务接口：

### 5.1 配置接口

```python
class Config:
    API_BASE_URL: str = "http://localhost:3001/api"
    WS_URL: str = "ws://localhost:3001"
    WC_PROJECT_ID: str = "xxx"
    CACHE_DIR: str = "~/.zetafrog"
```

### 5.2 缓存接口

```python
class CacheService:
    def get_frog(self) -> Optional[dict]:
        """获取缓存的青蛙数据"""
        
    def save_frog(self, frog: dict):
        """保存青蛙数据到本地"""
        
    def get_wallet_address(self) -> Optional[str]:
        """获取保存的钱包地址"""
```

---

## 六、错误处理

| 错误类型 | 处理方式 |
|----------|----------|
| 网络断开 | 显示离线状态，使用缓存数据 |
| API 错误 | 显示错误通知，重试机制 |
| 钱包断开 | 提示重新连接 |
| 签名拒绝 | 显示操作取消提示 |

---

## 七、变更记录

| 日期 | 内容 |
|------|------|
| 2026-01-14 | 初始版本 |
