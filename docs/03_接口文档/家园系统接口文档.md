---
status: 待审核
version: 2.0
last_updated: 2026-01-14
reviewer: 用户
---

# 家园系统接口文档

## 一、接口概览

### 1.1 Homestead API (`/api/homestead`)

| 分类 | 接口 | 方法 | 路径 | 版本 |
|------|------|------|------|------|
| 布局 | 获取布局 | GET | `/:frogId/layout/:sceneType` | V1.0 |
| 布局 | 保存布局 | POST | `/:frogId/layout/:sceneType` | V1.0 / **V2.0增强** |
| 布局 | 布局历史 | GET | `/:frogId/layout/:sceneType/history` | V1.0 |
| **编辑锁** | 获取编辑锁 | POST | `/:frogId/layout/:sceneType/lock` | **V2.0** |
| **编辑锁** | 释放编辑锁 | POST | `/:frogId/layout/:sceneType/lock/release` | **V2.0** |
| 装饰 | 装饰品列表 | GET | `/:frogId/decorations` | V1.0 |
| 装饰 | 未放置装饰 | GET | `/:frogId/decorations/unplaced/:sceneType` | V1.0 |
| 礼物 | 礼物列表 | GET | `/:frogId/gifts` | V1.0 |
| 礼物 | 发送礼物 | POST | `/:frogId/gifts` | V1.0 |
| 相册 | 获取相册 | GET | `/:frogId/photos` | V1.0 |
| 相册 | 创建照片 | POST | `/:frogId/photos` | V1.0 |
| 相册 | 铸造NFT | POST | `/:frogId/photos/:photoId/mint` | V1.0 |
| 成就 | 成就列表 | GET | `/achievements` | V1.0 |
| 成就 | 青蛙成就 | GET | `/:frogId/achievements` | V1.0 |
| 成就 | 领取成就 | POST | `/:frogId/achievements/:achievementId/claim` | V1.0 |
| **舒适度** | 获取舒适度 | GET | `/:frogId/comfort` | **V2.0** |
| **离线收益** | 获取离线收益 | GET | `/:frogId/offline-bonus` | **V2.0** |
| **离线收益** | 领取离线收益 | POST | `/:frogId/offline-bonus/claim` | **V2.0** |

### 1.2 Garden API (`/api/garden`)

| 分类 | 接口 | 方法 | 路径 | 版本 |
|------|------|------|------|------|
| 状态 | 家园状态 | GET | `/:frogId` | V1.0 |
| 访问 | 发起访问 | POST | `/:frogId/visit` | V1.0 |
| 访问 | 访客列表 | GET | `/:frogId/visitors` | V1.0 |
| 互动 | 创建互动 | POST | `/:frogId/interact` | V1.0 |
| 访问 | 离开家园 | POST | `/:frogId/leave` | V1.0 |
| 留言 | 获取留言 | GET | `/:frogId/messages` | V1.0 |
| 留言 | 发送留言 | POST | `/:frogId/messages` | V1.0 |
| **寻宝** | 寻宝状态 | GET | `/:frogId/treasure` | **V2.0** |
| **寻宝** | 领取寻宝 | POST | `/:frogId/treasure/claim` | **V2.0** |

---

## 二、布局接口

### 2.1 获取布局

```
GET /api/homestead/:frogId/layout/:sceneType
```

**路径参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| frogId | number | 青蛙 TokenId |
| sceneType | string | 场景类型: `yard` / `indoor` |

**响应（V2.0 增强）**

```json
{
  "success": true,
  "data": {
    "id": "layout_001",
    "frogId": 1,
    "sceneType": "yard",
    "version": 3,
    "gridCols": 12,
    "gridRows": 10,
    "comfortScore": 45,
    "editLock": null,
    "items": [
      {
        "id": "item_001",
        "userDecorationId": "ud_001",
        "gridX": 3,
        "gridY": 2,
        "scale": 1.0,
        "rotation": 0,
        "zIndex": 1,
        "state": "normal",
        "decoration": {
          "id": "dec_001",
          "name": "小树",
          "type": "PLANT",
          "assetUrl": "/assets/tree.png",
          "gridWidth": 1,
          "gridHeight": 2,
          "rarity": 2,
          "buffType": null,
          "weatherAnim": "tree_rain"
        }
      }
    ]
  }
}
```

### 2.2 保存布局（V2.0 网格版）

```
POST /api/homestead/:frogId/layout/:sceneType
```

**请求体**

```json
{
  "items": [
    {
      "userDecorationId": "ud_001",
      "gridX": 3,
      "gridY": 2,
      "scale": 1.0,
      "rotation": 0,
      "zIndex": 1
    }
  ],
  "createSnapshot": true,
  "sessionId": "session_abc123"
}
```

**响应**

```json
{
  "success": true,
  "data": {
    "layoutId": "layout_001",
    "version": 4,
    "comfortScore": 50,
    "activeBuffs": ["rest_reduce"]
  }
}
```

**错误码**

| HTTP | 错误码 | 说明 |
|------|--------|------|
| 409 | EDIT_LOCK_CONFLICT | 其他会话正在编辑 |
| 400 | GRID_COLLISION | 物品放置位置冲突 |
| 400 | OUT_OF_BOUNDS | 物品超出网格边界 |

---

## 三、【V2.0】编辑锁接口

### 3.1 获取编辑锁

```
POST /api/homestead/:frogId/layout/:sceneType/lock
```

**请求体**

```json
{
  "sessionId": "session_abc123"
}
```

**响应**

```json
{
  "success": true,
  "data": {
    "locked": true,
    "expiresAt": "2026-01-14T13:10:00.000Z"
  }
}
```

### 3.2 释放编辑锁

```
POST /api/homestead/:frogId/layout/:sceneType/lock/release
```

**请求体**

```json
{
  "sessionId": "session_abc123"
}
```

---

## 四、装饰品接口

### 4.1 获取装饰品库存（V2.0 增强）

```
GET /api/homestead/:frogId/decorations
```

**响应**

```json
{
  "success": true,
  "data": [
    {
      "id": "ud_001",
      "decorationId": "dec_001",
      "amount": 1,
      "decoration": {
        "name": "小树",
        "type": "PLANT",
        "assetUrl": "/assets/tree.png",
        "gridWidth": 1,
        "gridHeight": 2,
        "rarity": 2,
        "buffType": null,
        "buffValue": null,
        "weatherAnim": "tree_rain"
      }
    }
  ]
}
```

---

## 五、【V2.0】舒适度接口

### 5.1 获取舒适度和 Buff

```
GET /api/homestead/:frogId/comfort
```

**响应**

```json
{
  "success": true,
  "data": {
    "comfortScore": 65,
    "maxScore": 100,
    "level": "舒适",
    "activeBuffs": [
      {
        "code": "rest_reduce",
        "name": "缩短休息",
        "effect": "旅行归来休息时间 -10%",
        "fromDecoration": "舒适床铺"
      },
      {
        "code": "luck_boost",
        "name": "幸运提升",
        "effect": "发现稀有物品概率 +5%",
        "fromDecoration": "四叶草盆栽"
      }
    ]
  }
}
```

---

## 六、家园访问接口

### 6.1 获取家园状态（V2.0 增强）

```
GET /api/garden/:frogId
```

**响应**

```json
{
  "success": true,
  "data": {
    "frog": { ... },
    "background": "pond",
    "gridCols": 12,
    "gridRows": 10,
    "comfortScore": 65,
    "decorations": [...],
    "currentVisitors": [...],
    "todayVisitCount": 5,
    "totalVisitCount": 120,
    "treasureAvailable": true
  }
}
```

---

## 七、【V2.0】寻宝接口

### 7.1 获取今日寻宝状态

```
GET /api/garden/:frogId/treasure
```

**路径参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| frogId | number | 被访问家园的青蛙 ID |

**Query 参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| visitorId | number | 访客青蛙 ID |

**响应**

```json
{
  "success": true,
  "data": {
    "available": true,
    "todayFound": false,
    "lastFoundAt": null
  }
}
```

或

```json
{
  "success": true,
  "data": {
    "available": false,
    "todayFound": true,
    "lastFoundAt": "2026-01-14T08:30:00.000Z",
    "reward": {
      "type": "token",
      "amount": 5
    }
  }
}
```

### 7.2 领取寻宝奖励

```
POST /api/garden/:frogId/treasure/claim
```

**请求体**

```json
{
  "visitorFrogId": 2
}
```

**响应**

```json
{
  "success": true,
  "data": {
    "reward": {
      "type": "token",
      "id": null,
      "amount": 8,
      "name": "ZETA"
    },
    "animation": "treasure_open"
  }
}
```

**奖励类型**

| type | 说明 | 概率 |
|------|------|------|
| token | 代币奖励 (1-10 ZETA) | 50% |
| material | 素材奖励 (食物/物资) | 35% |
| decoration | 装饰品奖励 (稀有度 1-2) | 15% |

---

## 八、【V2.0】离线收益接口

### 8.1 获取离线收益

```
GET /api/homestead/:frogId/offline-bonus
```

**响应**

```json
{
  "success": true,
  "data": {
    "hasBonus": true,
    "offlineHours": 8,
    "comfortScore": 65,
    "bonus": {
      "type": "luck",
      "value": 12,
      "description": "幸运值 +12"
    }
  }
}
```

### 8.2 领取离线收益

```
POST /api/homestead/:frogId/offline-bonus/claim
```

**响应**

```json
{
  "success": true,
  "data": {
    "claimed": true,
    "bonus": {
      "type": "luck",
      "value": 12
    }
  }
}
```

---

## 九、错误码

| HTTP | 错误码 | 说明 |
|------|--------|------|
| 400 | INVALID_PARAMS | 参数错误 |
| 400 | GRID_COLLISION | 物品放置位置冲突 |
| 400 | OUT_OF_BOUNDS | 物品超出网格边界 |
| 403 | NOT_FRIEND | 非好友无法访问 |
| 403 | NOT_OWNER | 非所有者无法编辑 |
| 404 | NOT_FOUND | 资源不存在 |
| 409 | VERSION_CONFLICT | 布局版本冲突 |
| 409 | EDIT_LOCK_CONFLICT | 编辑锁冲突 |
| 429 | TREASURE_CLAIMED | 今日已领取寻宝奖励 |
| 500 | INTERNAL_ERROR | 服务器内部错误 |

---

## 十、变更记录

| 日期 | 版本 | 内容 |
|------|------|------|
| 2026-01-14 | 1.0 | 初始版本 |
| 2026-01-14 | 2.0 | V2.0 增强：格栅系统、编辑锁、舒适度、寻宝、离线收益 |
