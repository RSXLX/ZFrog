# ğŸ¸ é’è›™ç‚¹å‡»å¯¹è¯æ¡†äº¤äº’ä¼˜åŒ–

## ä¸€ã€äº¤äº’è®¾è®¡

### 1.1 äº¤äº’æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»é’è›™ SVG
    â†“
é’è›™æ’­æ”¾"è¢«ç‚¹"åŠ¨ç”»ï¼ˆè·³ä¸€ä¸‹/çœ¨çœ¼ï¼‰
    â†“
å¼¹å‡ºæ°”æ³¡å¯¹è¯æ¡†ï¼ˆä»é’è›™å¤´é¡¶å†’å‡ºï¼‰
    â†“
æ˜¾ç¤ºèŠå¤©ç•Œé¢
    â†“
ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­ / ç‚¹å‡»æœ€å°åŒ–æŒ‰é’®æ”¶èµ·
```

### 1.2 å¯¹è¯æ¡†æ ·å¼æ–¹æ¡ˆ

```
æ–¹æ¡ˆ Aï¼šæ°”æ³¡å¼ï¼ˆæ¨èï¼‰        æ–¹æ¡ˆ Bï¼šä¾§è¾¹æ å¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   èŠå¤©å†…å®¹   â”‚              â”‚                  â”‚
    â”‚             â”‚              â”‚    èŠå¤©é¢æ¿       â”‚
    â”‚   è¾“å…¥æ¡†    â”‚              â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚                  â”‚
           â–¼                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         ğŸ¸                                    ğŸ¸
```

**æ¨èæ–¹æ¡ˆ A**ï¼šæ°”æ³¡å¼æ›´ç¬¦åˆ"æ¡Œé¢å® ç‰©å¯¹è¯"çš„æ„Ÿè§‰

---

## äºŒã€ç»„ä»¶ç»“æ„

```
frontend/src/components/
â”œâ”€â”€ frog/
â”‚   â”œâ”€â”€ FrogBody.tsx           # é’è›™ SVG ä¸»ä½“ï¼ˆå·²æœ‰ï¼‰
â”‚   â”œâ”€â”€ FrogContainer.tsx      # æ–°å¢ï¼šé’è›™å®¹å™¨ï¼ˆåŒ…å«ç‚¹å‡»é€»è¾‘ï¼‰
â”‚   â””â”€â”€ FrogAnimations.ts      # æ–°å¢ï¼šåŠ¨ç”»å®šä¹‰
â”‚
â””â”€â”€ chat/
    â”œâ”€â”€ ChatBubble.tsx         # æ–°å¢ï¼šæ°”æ³¡å¯¹è¯æ¡†
    â”œâ”€â”€ ChatPanel.tsx          # èŠå¤©é¢æ¿å†…å®¹
    â”œâ”€â”€ ChatInput.tsx          # è¾“å…¥æ¡†
    â”œâ”€â”€ ChatMessage.tsx        # æ¶ˆæ¯æ°”æ³¡
    â””â”€â”€ QuickReplies.tsx       # å¿«æ·å›å¤æŒ‰é’®
```

---

## ä¸‰ã€æ ¸å¿ƒç»„ä»¶å®ç°

### 3.1 é’è›™å®¹å™¨ç»„ä»¶ (FrogContainer.tsx)

```tsx
// frontend/src/components/frog/FrogContainer.tsx

import { useState, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { FrogBody } from './FrogBody';
import { ChatBubble } from '../chat/ChatBubble';
import { useFrog } from '../../hooks/useFrog';

interface FrogContainerProps {
  frogId: number;
  initialPosition?: { x: number; y: number };
}

export function FrogContainer({ frogId, initialPosition }: FrogContainerProps) {
  const [isChatOpen, setIsChatOpen] = useState(false);
  const [isClicked, setIsClicked] = useState(false);
  const frogRef = useRef<HTMLDivElement>(null);
  const { frog } = useFrog(frogId);

  // å¤„ç†é’è›™ç‚¹å‡»
  const handleFrogClick = () => {
    // 1. æ’­æ”¾ç‚¹å‡»åŠ¨ç”»
    setIsClicked(true);
    setTimeout(() => setIsClicked(false), 300);

    // 2. æ‰“å¼€/å…³é—­å¯¹è¯æ¡†
    setIsChatOpen(prev => !prev);
  };

  // å¤„ç†ç‚¹å‡»å¤–éƒ¨å…³é—­
  const handleClickOutside = () => {
    setIsChatOpen(false);
  };

  return (
    <div 
      className="frog-container"
      style={{
        position: 'fixed',
        bottom: initialPosition?.y ?? 20,
        right: initialPosition?.x ?? 20,
        zIndex: 9999,
      }}
    >
      {/* èŠå¤©æ°”æ³¡ */}
      <AnimatePresence>
        {isChatOpen && (
          <ChatBubble
            frogId={frogId}
            frogName={frog?.name ?? 'å°è›™'}
            personality={frog?.personality ?? 'COMEDIAN'}
            onClose={() => setIsChatOpen(false)}
            onClickOutside={handleClickOutside}
          />
        )}
      </AnimatePresence>

      {/* é’è›™ä¸»ä½“ */}
      <motion.div
        ref={frogRef}
        className="frog-body-wrapper"
        onClick={handleFrogClick}
        animate={isClicked ? 'clicked' : 'idle'}
        variants={frogClickVariants}
        whileHover="hover"
        style={{ cursor: 'pointer' }}
      >
        <FrogBody 
          status={frog?.status} 
          mood={isChatOpen ? 'talking' : 'idle'}
        />
        
        {/* ç‚¹å‡»æç¤ºï¼ˆé¦–æ¬¡æ˜¾ç¤ºï¼‰ */}
        {!isChatOpen && (
          <motion.div 
            className="click-hint"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 2, duration: 0.5 }}
          >
            <span>ç‚¹æˆ‘èŠå¤© ğŸ’¬</span>
          </motion.div>
        )}
      </motion.div>
    </div>
  );
}

// é’è›™ç‚¹å‡»åŠ¨ç”»
const frogClickVariants = {
  idle: {
    scale: 1,
    rotate: 0,
  },
  hover: {
    scale: 1.05,
    transition: { duration: 0.2 }
  },
  clicked: {
    scale: [1, 0.9, 1.1, 1],
    rotate: [0, -5, 5, 0],
    transition: { duration: 0.3 }
  }
};
```

### 3.2 èŠå¤©æ°”æ³¡ç»„ä»¶ (ChatBubble.tsx)

```tsx
// frontend/src/components/chat/ChatBubble.tsx

import { useRef, useEffect } from 'react';
import { motion } from 'framer-motion';
import { ChatPanel } from './ChatPanel';
import { X, Minus } from 'lucide-react';

interface ChatBubbleProps {
  frogId: number;
  frogName: string;
  personality: string;
  onClose: () => void;
  onClickOutside: () => void;
}

export function ChatBubble({
  frogId,
  frogName,
  personality,
  onClose,
  onClickOutside,
}: ChatBubbleProps) {
  const bubbleRef = useRef<HTMLDivElement>(null);

  // ç‚¹å‡»å¤–éƒ¨æ£€æµ‹
  useEffect(() => {
    const handleClick = (e: MouseEvent) => {
      if (bubbleRef.current && !bubbleRef.current.contains(e.target as Node)) {
        // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†é’è›™æœ¬èº«
        const frogElement = document.querySelector('.frog-body-wrapper');
        if (frogElement && frogElement.contains(e.target as Node)) {
          return; // ç‚¹å‡»é’è›™ä¸å…³é—­
        }
        onClickOutside();
      }
    };

    document.addEventListener('mousedown', handleClick);
    return () => document.removeEventListener('mousedown', handleClick);
  }, [onClickOutside]);

  return (
    <motion.div
      ref={bubbleRef}
      className="chat-bubble"
      initial="hidden"
      animate="visible"
      exit="exit"
      variants={bubbleVariants}
    >
      {/* æ°”æ³¡å°–è§’ï¼ˆæŒ‡å‘é’è›™ï¼‰ */}
      <div className="bubble-arrow" />

      {/* æ°”æ³¡å†…å®¹ */}
      <div className="bubble-content">
        {/* æ ‡é¢˜æ  */}
        <div className="bubble-header">
          <div className="bubble-title">
            <span className="frog-emoji">ğŸ¸</span>
            <span className="frog-name">{frogName}</span>
            <span className="status-dot online" />
          </div>
          <div className="bubble-actions">
            <button 
              className="action-btn minimize"
              onClick={onClose}
              title="æœ€å°åŒ–"
            >
              <Minus size={14} />
            </button>
            <button 
              className="action-btn close"
              onClick={onClose}
              title="å…³é—­"
            >
              <X size={14} />
            </button>
          </div>
        </div>

        {/* èŠå¤©é¢æ¿ */}
        <ChatPanel
          frogId={frogId}
          frogName={frogName}
          personality={personality}
        />
      </div>
    </motion.div>
  );
}

// æ°”æ³¡å¼¹å‡ºåŠ¨ç”»
const bubbleVariants = {
  hidden: {
    opacity: 0,
    scale: 0.8,
    y: 20,
    originX: 1,
    originY: 1,
  },
  visible: {
    opacity: 1,
    scale: 1,
    y: 0,
    transition: {
      type: 'spring',
      stiffness: 300,
      damping: 25,
    }
  },
  exit: {
    opacity: 0,
    scale: 0.8,
    y: 20,
    transition: {
      duration: 0.2
    }
  }
};
```

### 3.3 æ ·å¼æ–‡ä»¶ (ChatBubble.css)

```css
/* frontend/src/components/chat/ChatBubble.css */

.chat-bubble {
  position: absolute;
  bottom: 100%; /* åœ¨é’è›™ä¸Šæ–¹ */
  right: 0;
  margin-bottom: 20px;
  width: 340px;
  max-height: 480px;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-radius: 16px;
  box-shadow: 
    0 10px 40px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(74, 222, 128, 0.2);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* æ°”æ³¡å°–è§’ */
.bubble-arrow {
  position: absolute;
  bottom: -10px;
  right: 30px;
  width: 0;
  height: 0;
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-top: 12px solid #16213e;
}

/* æ ‡é¢˜æ  */
.bubble-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: rgba(74, 222, 128, 0.1);
  border-bottom: 1px solid rgba(74, 222, 128, 0.2);
}

.bubble-title {
  display: flex;
  align-items: center;
  gap: 8px;
}

.frog-emoji {
  font-size: 20px;
}

.frog-name {
  font-weight: 600;
  color: #4ade80;
  font-size: 14px;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #4ade80;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.bubble-actions {
  display: flex;
  gap: 4px;
}

.action-btn {
  width: 24px;
  height: 24px;
  border: none;
  border-radius: 6px;
  background: transparent;
  color: #888;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.action-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
}

.action-btn.close:hover {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
}

/* æ°”æ³¡å†…å®¹åŒº */
.bubble-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ç‚¹å‡»æç¤º */
.click-hint {
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(74, 222, 128, 0.9);
  color: #000;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  white-space: nowrap;
  pointer-events: none;
}

.click-hint::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid rgba(74, 222, 128, 0.9);
}
```

### 3.4 èŠå¤©é¢æ¿ç»„ä»¶ (ChatPanel.tsx)

```tsx
// frontend/src/components/chat/ChatPanel.tsx

import { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChatMessage } from './ChatMessage';
import { ChatInput } from './ChatInput';
import { QuickReplies } from './QuickReplies';
import { useChat } from '../../hooks/useChat';
import { Loader2 } from 'lucide-react';

interface ChatPanelProps {
  frogId: number;
  frogName: string;
  personality: string;
}

export function ChatPanel({ frogId, frogName, personality }: ChatPanelProps) {
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const { messages, isLoading, sendMessage } = useChat(frogId);
  const [showQuickReplies, setShowQuickReplies] = useState(true);

  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  // å‘é€æ¶ˆæ¯
  const handleSend = async (text: string) => {
    setShowQuickReplies(false);
    await sendMessage(text);
  };

  // å¿«æ·å›å¤
  const quickReplies = [
    { label: 'ğŸ’° æŸ¥ä»·æ ¼', text: 'ETH ç°åœ¨å¤šå°‘é’±ï¼Ÿ' },
    { label: 'ğŸ‘› çœ‹èµ„äº§', text: 'æˆ‘é’±åŒ…é‡Œæœ‰å¤šå°‘é’±ï¼Ÿ' },
    { label: 'ğŸ¸ é—®çŠ¶æ€', text: 'ä½ ç°åœ¨åœ¨å¹²å˜›ï¼Ÿ' },
    { label: 'ğŸ‘‹ æ‰“æ‹›å‘¼', text: 'ä½ å¥½å‘€~' },
  ];

  return (
    <div className="chat-panel">
      {/* æ¶ˆæ¯åˆ—è¡¨ */}
      <div className="messages-container">
        {/* æ¬¢è¿æ¶ˆæ¯ */}
        {messages.length === 0 && (
          <motion.div
            className="welcome-message"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
          >
            <div className="welcome-avatar">ğŸ¸</div>
            <div className="welcome-text">
              <p>å‘±ï¼æˆ‘æ˜¯ <strong>{frogName}</strong></p>
              <p>æœ‰ä»€ä¹ˆæƒ³é—®æˆ‘çš„å—ï¼Ÿ</p>
            </div>
          </motion.div>
        )}

        {/* æ¶ˆæ¯åˆ—è¡¨ */}
        <AnimatePresence>
          {messages.map((msg, index) => (
            <ChatMessage
              key={index}
              message={msg}
              frogName={frogName}
            />
          ))}
        </AnimatePresence>

        {/* åŠ è½½ä¸­ */}
        {isLoading && (
          <motion.div
            className="typing-indicator"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
          >
            <span className="frog-typing">ğŸ¸</span>
            <div className="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </motion.div>
        )}

        <div ref={messagesEndRef} />
      </div>

      {/* å¿«æ·å›å¤ */}
      <AnimatePresence>
        {showQuickReplies && messages.length === 0 && (
          <QuickReplies
            replies={quickReplies}
            onSelect={handleSend}
          />
        )}
      </AnimatePresence>

      {/* è¾“å…¥æ¡† */}
      <ChatInput
        onSend={handleSend}
        disabled={isLoading}
        placeholder="å’Œé’è›™èŠç‚¹ä»€ä¹ˆ..."
      />
    </div>
  );
}
```

### 3.5 å¿«æ·å›å¤ç»„ä»¶ (QuickReplies.tsx)

```tsx
// frontend/src/components/chat/QuickReplies.tsx

import { motion } from 'framer-motion';

interface QuickReply {
  label: string;
  text: string;
}

interface QuickRepliesProps {
  replies: QuickReply[];
  onSelect: (text: string) => void;
}

export function QuickReplies({ replies, onSelect }: QuickRepliesProps) {
  return (
    <motion.div
      className="quick-replies"
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -10 }}
    >
      {replies.map((reply, index) => (
        <motion.button
          key={index}
          className="quick-reply-btn"
          onClick={() => onSelect(reply.text)}
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          initial={{ opacity: 0, x: -10 }}
          animate={{ 
            opacity: 1, 
            x: 0,
            transition: { delay: index * 0.1 }
          }}
        >
          {reply.label}
        </motion.button>
      ))}
    </motion.div>
  );
}
```

### 3.6 æ¶ˆæ¯ç»„ä»¶ (ChatMessage.tsx)

```tsx
// frontend/src/components/chat/ChatMessage.tsx

import { motion } from 'framer-motion';
import { PriceCard } from './PriceCard';
import { AssetCard } from './AssetCard';

interface Message {
  role: 'user' | 'assistant';
  content: string;
  intent?: string;
  data?: any;
  timestamp?: Date;
}

interface ChatMessageProps {
  message: Message;
  frogName: string;
}

export function ChatMessage({ message, frogName }: ChatMessageProps) {
  const isUser = message.role === 'user';

  return (
    <motion.div
      className={`chat-message ${isUser ? 'user' : 'assistant'}`}
      initial={{ opacity: 0, y: 10, x: isUser ? 10 : -10 }}
      animate={{ opacity: 1, y: 0, x: 0 }}
      transition={{ duration: 0.3 }}
    >
      {/* å¤´åƒ */}
      {!isUser && (
        <div className="message-avatar">ğŸ¸</div>
      )}

      <div className="message-content">
        {/* å‘é€è€…åç§° */}
        <div className="message-sender">
          {isUser ? 'ä½ ' : frogName}
        </div>

        {/* æ¶ˆæ¯æ–‡æœ¬ */}
        <div className="message-text">
          {message.content}
        </div>

        {/* é™„åŠ æ•°æ®å¡ç‰‡ */}
        {message.data && (
          <div className="message-data">
            {message.intent === 'price_query' && (
              <PriceCard data={message.data} />
            )}
            {message.intent === 'asset_query' && (
              <AssetCard data={message.data} />
            )}
          </div>
        )}
      </div>

      {/* ç”¨æˆ·å¤´åƒ */}
      {isUser && (
        <div className="message-avatar user">ğŸ‘¤</div>
      )}
    </motion.div>
  );
}
```

### 3.7 è¾“å…¥æ¡†ç»„ä»¶ (ChatInput.tsx)

```tsx
// frontend/src/components/chat/ChatInput.tsx

import { useState, useRef, KeyboardEvent } from 'react';
import { Send } from 'lucide-react';
import { motion } from 'framer-motion';

interface ChatInputProps {
  onSend: (text: string) => void;
  disabled?: boolean;
  placeholder?: string;
}

export function ChatInput({ onSend, disabled, placeholder }: ChatInputProps) {
  const [input, setInput] = useState('');
  const inputRef = useRef<HTMLInputElement>(null);

  const handleSend = () => {
    if (input.trim() && !disabled) {
      onSend(input.trim());
      setInput('');
    }
  };

  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <div className="chat-input-container">
      <input
        ref={inputRef}
        type="text"
        className="chat-input"
        value={input}
        onChange={(e) => setInput(e.target.value)}
        onKeyDown={handleKeyDown}
        placeholder={placeholder || 'è¾“å…¥æ¶ˆæ¯...'}
        disabled={disabled}
      />
      <motion.button
        className="send-btn"
        onClick={handleSend}
        disabled={!input.trim() || disabled}
        whileHover={{ scale: 1.1 }}
        whileTap={{ scale: 0.9 }}
      >
        <Send size={18} />
      </motion.button>
    </div>
  );
}
```

---

## å››ã€æ ·å¼è¡¥å……

```css
/* frontend/src/components/chat/ChatPanel.css */

.chat-panel {
  display: flex;
  flex-direction: column;
  height: 380px;
}

/* æ¶ˆæ¯å®¹å™¨ */
.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* æ»šåŠ¨æ¡æ ·å¼ */
.messages-container::-webkit-scrollbar {
  width: 6px;
}

.messages-container::-webkit-scrollbar-track {
  background: transparent;
}

.messages-container::-webkit-scrollbar-thumb {
  background: rgba(74, 222, 128, 0.3);
  border-radius: 3px;
}

/* æ¬¢è¿æ¶ˆæ¯ */
.welcome-message {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: rgba(74, 222, 128, 0.1);
  border-radius: 12px;
  border: 1px dashed rgba(74, 222, 128, 0.3);
}

.welcome-avatar {
  font-size: 32px;
}

.welcome-text {
  color: #ccc;
  font-size: 14px;
  line-height: 1.5;
}

.welcome-text strong {
  color: #4ade80;
}

/* æ¶ˆæ¯æ ·å¼ */
.chat-message {
  display: flex;
  gap: 8px;
  align-items: flex-start;
}

.chat-message.user {
  flex-direction: row-reverse;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(74, 222, 128, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.message-avatar.user {
  background: rgba(59, 130, 246, 0.2);
}

.message-content {
  max-width: 75%;
}

.message-sender {
  font-size: 11px;
  color: #888;
  margin-bottom: 4px;
}

.chat-message.user .message-sender {
  text-align: right;
}

.message-text {
  background: rgba(255, 255, 255, 0.05);
  padding: 10px 14px;
  border-radius: 12px;
  color: #eee;
  font-size: 14px;
  line-height: 1.5;
  word-break: break-word;
}

.chat-message.user .message-text {
  background: rgba(74, 222, 128, 0.2);
  border-radius: 12px 12px 4px 12px;
}

.chat-message.assistant .message-text {
  border-radius: 12px 12px 12px 4px;
}

/* æ•°æ®å¡ç‰‡ */
.message-data {
  margin-top: 8px;
}

/* æ‰“å­—æŒ‡ç¤ºå™¨ */
.typing-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
}

.frog-typing {
  font-size: 20px;
  animation: bounce 0.6s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.typing-dots {
  display: flex;
  gap: 4px;
}

.typing-dots span {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #4ade80;
  animation: typing 1.4s infinite;
}

.typing-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
  30% { opacity: 1; transform: translateY(-4px); }
}

/* å¿«æ·å›å¤ */
.quick-replies {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 8px 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.quick-reply-btn {
  padding: 6px 12px;
  background: rgba(74, 222, 128, 0.1);
  border: 1px solid rgba(74, 222, 128, 0.3);
  border-radius: 16px;
  color: #4ade80;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.quick-reply-btn:hover {
  background: rgba(74, 222, 128, 0.2);
  border-color: #4ade80;
}

/* è¾“å…¥æ¡† */
.chat-input-container {
  display: flex;
  gap: 8px;
  padding: 12px 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(0, 0, 0, 0.2);
}

.chat-input {
  flex: 1;
  padding: 10px 14px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  color: #fff;
  font-size: 14px;
  outline: none;
  transition: all 0.2s;
}

.chat-input:focus {
  border-color: rgba(74, 222, 128, 0.5);
  background: rgba(255, 255, 255, 0.08);
}

.chat-input::placeholder {
  color: #666;
}

.send-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #4ade80, #22c55e);
  border: none;
  color: #000;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.send-btn:hover:not(:disabled) {
  box-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

---

## äº”ã€ä½¿ç”¨æ–¹å¼

### 5.1 åœ¨ Desktop é¡µé¢ä¸­ä½¿ç”¨

```tsx
// frontend/src/pages/Desktop.tsx

import { FrogContainer } from '../components/frog/FrogContainer';
import { useAccount } from 'wagmi';
import { useFrogs } from '../hooks/useFrogs';

export function Desktop() {
  const { address } = useAccount();
  const { frogs } = useFrogs(address);

  // è·å–ç”¨æˆ·çš„ç¬¬ä¸€åªé’è›™
  const myFrog = frogs?.[0];

  return (
    <div className="desktop-page">
      {/* å…¶ä»–æ¡Œé¢å†…å®¹ */}
      
      {/* é’è›™å®¹å™¨ï¼ˆå«ç‚¹å‡»èŠå¤©ï¼‰ */}
      {myFrog && (
        <FrogContainer
          frogId={myFrog.id}
          initialPosition={{ x: 30, y: 30 }}
        />
      )}
    </div>
  );
}
```

### 5.2 è‡ªå®šä¹‰ Hook

```tsx
// frontend/src/hooks/useChat.ts

import { useState, useCallback } from 'react';
import { chatApi } from '../services/chat.api';

interface Message {
  role: 'user' | 'assistant';
  content: string;
  intent?: string;
  data?: any;
}

export function useChat(frogId: number) {
  const [messages, setMessages] = useState<Message[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [sessionId, setSessionId] = useState<number | null>(null);

  const sendMessage = useCallback(async (text: string) => {
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    setMessages(prev => [...prev, { role: 'user', content: text }]);
    setIsLoading(true);

    try {
      const response = await chatApi.sendMessage(frogId, text, sessionId);
      
      // æ›´æ–° sessionId
      if (!sessionId) {
        setSessionId(response.sessionId);
      }

      // æ·»åŠ é’è›™å›å¤
      setMessages(prev => [...prev, {
        role: 'assistant',
        content: response.reply.content,
        intent: response.reply.intent,
        data: response.reply.data,
      }]);
    } catch (error) {
      // é”™è¯¯å¤„ç†
      setMessages(prev => [...prev, {
        role: 'assistant',
        content: 'å‘±...å‡ºäº†ç‚¹é—®é¢˜ï¼Œç­‰ä¼šå†è¯•è¯•ï¼Ÿ',
      }]);
    } finally {
      setIsLoading(false);
    }
  }, [frogId, sessionId]);

  const clearMessages = useCallback(() => {
    setMessages([]);
    setSessionId(null);
  }, []);

  return {
    messages,
    isLoading,
    sendMessage,
    clearMessages,
  };
}
```

---

## å…­ã€äº¤äº’æ•ˆæœé¢„è§ˆ

```
åˆå§‹çŠ¶æ€ï¼š
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ ç‚¹æˆ‘èŠå¤©ğŸ’¬â”‚
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                              â–¼
                            ğŸ¸
                        (é’è›™å¾…æœºåŠ¨ç”»)

ç‚¹å‡»åï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ¸ å°è›™ â—               â”‚ â”€ âœ•
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                         â”‚
    â”‚  ğŸ¸ å‘±ï¼æˆ‘æ˜¯å°è›™        â”‚
    â”‚     æœ‰ä»€ä¹ˆæƒ³é—®æˆ‘çš„å—ï¼Ÿ   â”‚
    â”‚                         â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”        â”‚
    â”‚ â”‚ğŸ’°æŸ¥ä»·â”‚ â”‚ğŸ‘›çœ‹èµ„â”‚ ...   â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ [å’Œé’è›™èŠç‚¹ä»€ä¹ˆ...] [â¤] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
             ğŸ¸
         (é’è›™è¯´è¯åŠ¨ç”»)
```

---

**ç°åœ¨ç‚¹å‡»é’è›™å°±èƒ½å¼¹å‡ºå¯çˆ±çš„èŠå¤©æ°”æ³¡äº†ï¼** ğŸ¸ğŸ’¬