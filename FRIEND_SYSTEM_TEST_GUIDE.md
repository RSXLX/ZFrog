# ZetaFrog V2.0 好友系统测试指南

## 📋 测试前准备

### 1. 启动后端服务
```bash
cd backend
npm run dev
```

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```

### 3. 确保数据库已配置
确保 `backend/.env` 文件中的 `DATABASE_URL` 已正确配置。

## 🧪 自动化测试

### 运行后端API测试
```bash
cd backend
npx ts-node scripts/test-friends-system.ts
```

该测试脚本将验证：
- ✅ 后端健康检查
- ✅ 青蛙搜索功能（按地址、名称）
- ✅ 发送好友请求
- ✅ 获取好友请求列表
- ✅ 接受/拒绝好友请求
- ✅ 获取好友列表（含在线状态）
- ✅ 好友互动
- ✅ 获取互动记录

## 🖱️ 手动测试

### 1. 好友搜索功能

**步骤：**
1. 打开前端应用并连接钱包
2. 铸造至少2只青蛙（用于测试）
3. 进入任一青蛙的好友页面
4. 点击"添加好友"按钮
5. 在搜索框中输入：
   - 钱包地址（0x...）
   - 青蛙名称
   - tokenId（数字）

**预期结果：**
- 搜索结果显示匹配的青蛙
- 不显示自己的青蛙
- 不显示已经是好友的青蛙

### 2. 发送好友请求

**步骤：**
1. 在搜索结果中选择一只青蛙
2. 点击"发送好友请求"按钮

**预期结果：**
- 显示"好友请求已发送"提示
- 该青蛙从搜索结果中消失

### 3. 接收好友请求

**步骤：**
1. 切换到另一个钱包账户（或使用另一个浏览器）
2. 进入收到请求的青蛙的好友页面
3. 在左侧"好友请求"区域查看新请求

**预期结果：**
- 显示好友请求卡片
- 显示请求者信息（名称、等级、经验等）
- 显示"接受"和"拒绝"按钮

### 4. 响应好友请求

**步骤：**
1. 点击"接受"或"拒绝"按钮

**预期结果：**
- 接受：好友出现在好友列表中
- 拒绝：请求从列表中移除

### 5. 在线状态指示

**步骤：**
1. 在好友列表中查看好友卡片
2. 观察好友名称旁的圆点指示器

**预期结果：**
- 绿色圆点 = 好友在线
- 灰色圆点 = 好友离线
- 当好友上线/离线时，圆点实时更新

### 6. 好友互动

**步骤：**
1. 在好友列表中点击"互动"按钮
2. 选择互动类型：
   - 💬 留言
   - 🏠 拜访
   - 🍃 喂食
   - 🎮 玩耍
   - 🎁 送礼
   - ✈️ 旅行
3. 输入留言（可选）
4. 点击"发送"

**预期结果：**
- 显示"发送中..."
- 互动成功后，互动记录出现在历史中
- 好友收到WebSocket通知（如果在线）

### 7. 查看互动历史

**步骤：**
1. 在好友互动弹窗中向下滚动
2. 查看"互动历史"区域

**预期结果：**
- 显示最近10条互动记录
- 自己的互动在右侧（蓝色背景）
- 好友的互动在左侧（灰色背景）
- 显示互动类型图标和时间

### 8. 删除好友

**步骤：**
1. 在好友列表中点击"删除"按钮
2. 确认删除操作

**预期结果：**
- 好友从列表中移除
- 双方都收到WebSocket通知
- 互动记录被清除

### 9. 移动端响应式测试

**步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到移动设备模拟模式
3. 测试不同屏幕尺寸：
   - 手机（375px）
   - 平板（768px）
   - 桌面（1024px+）

**预期结果：**
- 小屏幕：好友请求和好友列表垂直堆叠
- 按钮自适应宽度
- 弹窗正常显示，不贴边
- 互动类型网格在小屏幕2列显示

### 10. 加载骨架屏测试

**步骤：**
1. 清除浏览器缓存
2. 刷新页面
3. 观察加载过程

**预期结果：**
- 数据加载时显示骨架屏动画
- 骨架屏布局与实际内容一致
- 加载完成后平滑过渡到真实内容

## 🔍 WebSocket实时通信测试

### 测试步骤：
1. 打开两个浏览器窗口（或使用隐私模式）
2. 在两个窗口中分别登录不同的钱包
3. 让两只青蛙成为好友
4. 在窗口A中进行操作，观察窗口B的实时更新

### 应该实时更新的事件：
- ✅ 收到好友请求
- ✅ 好友请求被接受/拒绝
- ✅ 好友发起互动
- ✅ 好友上线/离线
- ✅ 好友被删除

## 📊 测试检查清单

### 后端API
- [ ] GET /api/health - 健康检查
- [ ] GET /api/frogs/search - 搜索青蛙
- [ ] POST /api/friends/request - 发送好友请求
- [ ] GET /api/friends/requests/:frogId - 获取好友请求
- [ ] PUT /api/friends/request/:id/respond - 响应好友请求
- [ ] GET /api/friends/list/:frogId - 获取好友列表（含在线状态）
- [ ] POST /api/friends/:friendshipId/interact - 好友互动
- [ ] GET /api/friends/:friendshipId/interactions - 获取互动记录
- [ ] DELETE /api/friends/:friendshipId - 删除好友

### 前端组件
- [ ] Friends.tsx - 好友系统主页面
- [ ] FriendsList.tsx - 好友列表（含在线状态指示）
- [ ] FriendRequests.tsx - 好友请求列表
- [ ] FriendInteraction.tsx - 好友互动弹窗
- [ ] AddFriend.tsx - 添加好友弹窗（含搜索）
- [ ] Skeleton.tsx - 加载骨架屏

### WebSocket事件
- [ ] friend:requestReceived - 收到好友请求
- [ ] friend:requestStatusChanged - 好友请求状态变化
- [ ] friend:interaction - 好友互动
- [ ] friend:removed - 好友被删除
- [ ] friend:onlineStatusChanged - 好友在线状态变化

### UI/UX
- [ ] 在线状态指示器（绿色/灰色圆点）
- [ ] 移动端响应式布局
- [ ] 加载骨架屏动画
- [ ] 浏览器通知（需要授权）
- [ ] 错误提示
- [ ] 成功提示

## 🐛 已知问题

无

## 📝 测试注意事项

1. **数据库状态**：测试前确保数据库中至少有2只青蛙
2. **WebSocket连接**：确保前端正确连接到后端WebSocket服务
3. **浏览器通知**：首次使用需要授权浏览器通知
4. **网络延迟**：在线状态更新可能有1-2秒延迟
5. **多设备测试**：建议使用不同设备或浏览器测试实时通信

## 🎯 测试目标

- ✅ 所有API端点正常工作
- ✅ WebSocket实时通信正常
- ✅ 在线状态准确显示
- ✅ 移动端布局友好
- ✅ 加载体验流畅
- ✅ 无JavaScript错误
- ✅ 无网络请求失败

---

**测试完成后，请在此文档中记录发现的问题和建议。**
