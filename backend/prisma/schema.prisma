generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Frog {
  id               Int                 @id @default(autoincrement())
  tokenId          Int                 @unique
  name             String
  ownerAddress     String              @unique
  birthday         DateTime
  totalTravels     Int                 @default(0)
  status           FrogStatus          @default(Idle)
  xp               Int                 @default(0)
  level            Int                 @default(1)
  personality      Personality         @default(PHILOSOPHER)  // æ–°å¢ï¼šæ€§æ ¼
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  p0Travels        Int                 @default(0)
  interactions     FriendInteraction[] @relation("InteractionActor")
  receivedRequests Friendship[]        @relation("FriendshipAddressee")
  sentRequests     Friendship[]        @relation("FriendshipRequester")
  travelStats      FrogTravelStats?
  souvenirs        Souvenir[]
  travels          Travel[]
  badges           UserBadge[]
  earnedTravelBadges EarnedTravelBadge[] // å·²è·å¾—çš„æ—…è¡Œå¾½ç« 
  chatSessions     ChatSession[]       // æ–°å¢ï¼šå…³è”èŠå¤©ä¼šè¯
  groupTravelsAsLeader    GroupTravel[] @relation("GroupTravelLeader")
  groupTravelsAsCompanion GroupTravel[] @relation("GroupTravelCompanion")
  visitorMessages  VisitorMessage[]    // ä¸²é—¨ç•™è¨€
  
  // ğŸ†• å®¶å›­ç³»ç»Ÿå…³è”
  decorations        UserDecoration[]    // æ‹¥æœ‰çš„è£…é¥°å“
  roomLayouts        RoomLayout[]        // å¸ƒå±€é…ç½®
  receivedGifts      Gift[]              // æ”¶åˆ°çš„ç¤¼ç‰©
  photos             Photo[]             // ç›¸å†Œç…§ç‰‡
  earnedAchievements EarnedAchievement[] // å·²è·å¾—çš„æˆå°±
  
  // ğŸ†• è·¨é“¾è½¬è´¦å…³è”
  transfersSent      CrossChainTransfer[] @relation("TransfersSent")
  transfersReceived  CrossChainTransfer[] @relation("TransfersReceived")
  footprints         TravelFootprint[]

  @@index([ownerAddress])
}

model Travel {
  id                 Int                    @id @default(autoincrement())
  frogId             Int
   
  // ç›®æ ‡ä¿¡æ¯ï¼ˆå‡çº§ï¼‰
  targetWallet       String                 // ç›®æ ‡é’±åŒ…åœ°å€
  targetChain        ChainType              @default(ZETACHAIN_ATHENS)  // ç›®æ ‡é“¾ç±»å‹
  chainId            Int                    @default(7001)              // æ•°å€¼å‹ chainIdï¼Œä¸åˆçº¦ä¸€è‡´
  
  // éšæœºæ¢ç´¢æ”¯æŒ
  isRandom           Boolean                @default(false)             // æ˜¯å¦éšæœºæ¢ç´¢
  originalTarget     String?                                           // åŸå§‹ç›®æ ‡ï¼ˆéšæœºæ—¶ä¸ºé›¶åœ°å€ï¼‰
  discoveredAt       DateTime?                                         // åœ°å€å‘ç°æ—¶é—´
  
  // æ—¶é—´
  startTime          DateTime
  endTime            DateTime
  duration           Int                    @default(3600)              // æ—…è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤1å°æ—¶
  
  // çŠ¶æ€
  status             TravelStatus           @default(Active)
  currentStage       TravelStage            @default(DEPARTING)         // å½“å‰é˜¶æ®µ
  progress           Int                    @default(0)                  // è¿›åº¦ 0-100
  
  // è·¨é“¾äº¤æ˜“è¿½è¸ª
  startTxHash        String?                                           // å¼€å§‹æ—…è¡Œçš„äº¤æ˜“å“ˆå¸Œ
  completeTxHash     String?                                           // å®Œæˆæ—…è¡Œçš„äº¤æ˜“å“ˆå¸Œ
  
  // è§‚å¯Ÿç»“æœ
  observedTxCount    Int?
  observedTotalValue String?
  
  // AI ç”Ÿæˆå†…å®¹
  journalHash        String?
  journalContent     String?
  
  // çºªå¿µå“
  souvenirId         Int?
  
  // é”™è¯¯å¤„ç†
  errorMessage       String?                                           // é”™è¯¯ä¿¡æ¯
  
  // æ—¶é—´æˆ³
  completedAt        DateTime?
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  
  // ============ è·¨é“¾æ—…è¡Œç›¸å…³ ============
  isCrossChain         Boolean               @default(false)    // æ˜¯å¦çœŸæ­£è·¨é“¾æ—…è¡Œ
  crossChainStatus     CrossChainStatus?                        // è·¨é“¾çŠ¶æ€
  footprints           TravelFootprint[]
  crossChainMessageId  String?                                  // è·¨é“¾æ¶ˆæ¯ID
  lockTxHash           String?                                  // é”å®šäº¤æ˜“å“ˆå¸Œ
  unlockTxHash         String?                                  // è§£é”äº¤æ˜“å“ˆå¸Œ
  targetChainArrivalTime DateTime?                              // ç›®æ ‡é“¾åˆ°è¾¾æ—¶é—´
  targetChainActions   Json?                                    // ç›®æ ‡é“¾æ“ä½œè®°å½•
  returnMessageId      String?                                  // è¿”å›æ¶ˆæ¯ID
  crossChainXpEarned   Int?                                     // è·¨é“¾è·å¾—çš„XP
  refundAmount         String?                                  // å¹²ç²®è¿”è¿˜é‡‘é¢ (wei)
  
  // å…¼å®¹æ—§å­—æ®µ
  exploredBlock      BigInt?
  exploredTimestamp  DateTime?
  exploredSnapshot   Json?
  diary              String?
  diaryMood          DiaryMood?
  souvenirData       Json?
  addressDiscoveredAt DateTime?
  originalTargetAddress String?

  
  // å…³è”
  frog               Frog                   @relation(fields: [frogId], references: [id])
  souvenir           Souvenir?              @relation(fields: [souvenirId], references: [id])
  observations       WalletObservation[]
  groupTravel        GroupTravel?           // ç»“ä¼´æ—…è¡Œä¿¡æ¯
  statusMessages     TravelStatusMessage[]  // çŠ¶æ€æ¶ˆæ¯
  discoveries        TravelDiscovery[]      // æ—…è¡Œå‘ç°
  interactions       TravelInteraction[]    // è·¨é“¾æ¢ç´¢äº’åŠ¨è®°å½•
  visitorMessages    VisitorMessage[]       // ä¸²é—¨ç•™è¨€
  photos             Photo[]                // ğŸ†• æ—…è¡Œç…§ç‰‡

  @@index([frogId])
  @@index([status])
  @@index([endTime])
  @@index([targetChain])                                          // æ–°å¢ç´¢å¼•
  @@index([exploredBlock])
  @@index([isRandom])
  @@index([addressDiscoveredAt])
}

// æ—…è¡Œå‘ç° - ä¿å­˜æ¢ç´¢è¿‡ç¨‹ä¸­å‘ç°çš„åŒºå—ä¿¡æ¯
model TravelDiscovery {
  id          Int           @id @default(autoincrement())
  travelId    Int
  type        DiscoveryType
  title       String
  description String
  rarity      Int           @default(1) // 1-5 ç¨€æœ‰åº¦
  
  // åŒºå—ä¿¡æ¯
  blockNumber BigInt?
  chainType   ChainType     @default(ZETACHAIN_ATHENS)
  
  // é™„åŠ æ•°æ® (ä½™é¢ã€äº¤æ˜“å“ˆå¸Œç­‰)
  metadata    Json?
  
  createdAt   DateTime      @default(now())
  
  travel      Travel        @relation(fields: [travelId], references: [id])
  
  @@index([travelId])
  @@index([type])
  @@index([rarity])
}

// æ–°å¢ï¼šæ—…è¡ŒçŠ¶æ€æ¶ˆæ¯
model TravelStatusMessage {
  id          Int         @id @default(autoincrement())
  travelId    Int
  message     String
  messageType MessageType @default(INFO)
  createdAt   DateTime    @default(now())
  
  travel      Travel      @relation(fields: [travelId], references: [id])
  
  @@index([travelId])
}

// æ–°å¢ï¼šè·¨é“¾æ¢ç´¢äº’åŠ¨è®°å½• (å‘¨æœŸæ€§æ¢ç´¢è¶³è¿¹)
model TravelInteraction {
  id              Int       @id @default(autoincrement())
  travelId        Int
  chainId         Int
  blockNumber     BigInt
  message         String                        // è§‚å¯Ÿ/ç•™è¨€å†…å®¹
  exploredAddress String?                       // æ¢ç´¢çš„åœ°å€
  isContract      Boolean   @default(false)     // æ˜¯å¦æ˜¯åˆçº¦åœ°å€
  txHash          String?                       // é“¾ä¸Šäº¤æ˜“å“ˆå¸Œ (å¦‚æœä¸Šé“¾)
  createdAt       DateTime  @default(now())
  
  travel          Travel    @relation(fields: [travelId], references: [id])
  
  @@index([travelId])
  @@index([chainId, blockNumber])
}

// æ–°å¢ï¼šå·²è·å¾—çš„æ—…è¡Œå¾½ç«  (è·¨é“¾æ¢ç´¢æˆå°±)
model EarnedTravelBadge {
  id          Int       @id @default(autoincrement())
  frogId      Int
  badgeType   String    // 'CROSS_CHAIN_PIONEER', 'EXPLORER', 'CONTRACT_HUNTER', 'WHALE_TRACKER', 'RAINBOW_TRAVELER'
  earnedAt    DateTime  @default(now())
  metadata    Json?     // è·å¾—æ—¶çš„è¯¦ç»†ä¿¡æ¯
  
  frog        Frog      @relation(fields: [frogId], references: [id])
  
  @@unique([frogId, badgeType])
  @@index([frogId])
  @@index([badgeType])
}

model Souvenir {
  id          Int        @id @default(autoincrement())
  tokenId     Int
  frogId      Int
  name        String
  rarity      Rarity
  metadataUri String?
  chainType   ChainType  @default(ZETACHAIN_ATHENS)                 // æ¥æºé“¾
  mintedAt    DateTime
  createdAt   DateTime   @default(now())
  frog        Frog       @relation(fields: [frogId], references: [id])
  travels     Travel[]

  @@unique([tokenId, chainType])
  @@index([frogId])
  @@index([chainType])
}

model WalletObservation {
  id             Int       @id @default(autoincrement())
  travelId       Int
  walletAddress  String
  chainId        Int
  chainType      ChainType @default(ZETACHAIN_ATHENS)               // æ–°å¢
  transactions   Json
  totalTxCount   Int
  totalValueWei  String
  notableEvents  Json?
  
  // æ–°å¢ï¼šæ›´è¯¦ç»†çš„è§‚å¯Ÿæ•°æ®
  nativeBalance  String?                                             // åŸç”Ÿä»£å¸ä½™é¢
  tokenBalances  Json?                                               // ä»£å¸ä½™é¢
  protocols      String[]  @default([])                              // äº¤äº’çš„åè®®
  
  observedFrom   DateTime
  observedTo     DateTime
  createdAt      DateTime  @default(now())
  travel         Travel    @relation(fields: [travelId], references: [id])

  @@index([travelId])
  @@index([walletAddress])
  @@index([chainType])                                               // æ–°å¢ç´¢å¼•
}

model TravelFootprint {
  id             Int       @id @default(autoincrement())
  travelId       Int
  frogId         Int
  chainId        Int
  chainType      ChainType @default(ZETACHAIN_ATHENS)
  txHash         String
  walletAddress  String    // è¢«ç•™è¨€çš„é’±åŒ…åœ°å€
  message        String    // ç•™è¨€å†…å®¹
  timestamp      DateTime  @default(now())
  
  travel         Travel    @relation(fields: [travelId], references: [id])
  frog           Frog      @relation(fields: [frogId], references: [id])

  @@index([travelId])
  @@index([frogId])
  @@index([walletAddress])
}

model SouvenirImage {
  id             String                @id @default(uuid())
  odosId         String
  travelId       String
  souvenirId     String
  souvenirType   String
  souvenirName   String
  rarity         String
  chainId        Int?
  prompt         String
  negativePrompt String?
  actualPrompt   String?
  imageUrl       String?
  ipfsHash       String?
  ipfsUrl        String?
  gatewayUrl     String?
  fileSize       Int?
  seed           Int
  stylePreset    String?
  status         ImageGenerationStatus @default(PENDING)
  retryCount     Int                   @default(0)
  errorMessage   String?
  generatedAt    DateTime?
  uploadedAt     DateTime?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt

  @@index([odosId])
  @@index([souvenirId])
  @@index([status])
}

model Friendship {
  id           Int                 @id @default(autoincrement())
  requesterId  Int
  addresseeId  Int
  status       FriendshipStatus    @default(Pending)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  interactions FriendInteraction[]
  addressee    Frog                @relation("FriendshipAddressee", fields: [addresseeId], references: [id])
  requester    Frog                @relation("FriendshipRequester", fields: [requesterId], references: [id])

  @@unique([requesterId, addresseeId])
  @@index([status])
}

model FriendInteraction {
  id           Int             @id @default(autoincrement())
  friendshipId Int
  actorId      Int
  type         InteractionType
  message      String?
  metadata     Json?
  likesCount   Int             @default(0)  // Added for message likes
  createdAt    DateTime        @default(now())
  actor        Frog            @relation("InteractionActor", fields: [actorId], references: [id])
  friendship   Friendship      @relation(fields: [friendshipId], references: [id])

  @@index([friendshipId])
  @@index([actorId])
}

model TravelBadge {
  id              String          @id @default(cuid())
  code            String          @unique
  name            String
  description     String
  icon            String
  unlockType      BadgeUnlockType
  unlockCondition Json
  rarity          Int             @default(1)
  isHidden        Boolean         @default(false)
  createdAt       DateTime        @default(now())
  userBadges      UserBadge[]
}

model UserBadge {
  id                 String      @id @default(cuid())
  frogId             Int
  badgeId            String
  unlockedAt         DateTime    @default(now())
  unlockedByTravelId Int?
  badge              TravelBadge @relation(fields: [badgeId], references: [id])
  frog               Frog        @relation(fields: [frogId], references: [id])

  @@unique([frogId, badgeId])
  @@index([frogId])
}

model FrogTravelStats {
  id                   String    @id @default(cuid())
  frogId               Int       @unique
  totalTrips           Int       @default(0)
  bscTrips             Int       @default(0)
  ethTrips             Int       @default(0)
  zetaTrips            Int       @default(0)
  totalDiscoveries     Int       @default(0)
  rareFinds            Int       @default(0)
  earliestBlockVisited BigInt?
  oldestDateVisited    DateTime?
  updatedAt            DateTime  @updatedAt
  frog                 Frog      @relation(fields: [frogId], references: [id])

  @@index([frogId])
}

enum FrogStatus {
  Idle
  Traveling
  Returning
  CrossChainLocked  // Added for cross-chain travel
}

enum TravelStatus {
  Active      // æ—…è¡Œä¸­
  Processing  // å¤„ç†ä¸­ï¼ˆè§‚å¯Ÿé’±åŒ…ã€ç”ŸæˆAIå†…å®¹ï¼‰
  Completed   // å·²å®Œæˆ
  Cancelled   // å·²å–æ¶ˆ
  Failed      // å¤±è´¥
}

// æ–°å¢ï¼šæ—…è¡Œé˜¶æ®µ
enum TravelStage {
  DEPARTING   // å‡ºå‘ä¸­
  CROSSING    // è·¨é“¾ç©¿è¶Šä¸­
  ARRIVING    // åˆ°è¾¾ä¸­
  EXPLORING   // æ¢ç´¢ä¸­
  RETURNING   // è¿”ç¨‹ä¸­
}

// æ–°å¢ï¼šæ¶ˆæ¯ç±»å‹
enum MessageType {
  INFO
  DISCOVERY
  JOKE
  WARNING
  ERROR
}

enum Rarity {
  Common
  Uncommon
  Rare
  Epic
  Legendary
}

// å‘ç°ç±»å‹
enum DiscoveryType {
  balance        // ä½™é¢å‘ç°
  activity       // æ´»åŠ¨å‘ç°
  timing         // æ—¶æœºå‘ç°
  fun_fact       // è¶£é—»
  cross_chain    // è·¨é“¾å‘ç°
  token_holding  // ä»£å¸æŒæœ‰
  tx_action      // äº¤æ˜“è¡Œä¸º
  gas_price      // Gasä»·æ ¼
}

// æ–°å¢ï¼šæ”¯æŒçš„é“¾ç±»å‹ï¼ˆä¸ chains.ts ä¿æŒä¸€è‡´ï¼‰
enum ChainType {
  BSC_TESTNET       // chainId: 97
  ETH_SEPOLIA       // chainId: 11155111
  ZETACHAIN_ATHENS  // chainId: 7001
  POLYGON_MUMBAI    // chainId: 80001 (å¯é€‰æ‰©å±•)
  ARBITRUM_GOERLI   // chainId: 421613 (å¯é€‰æ‰©å±•)
}

// ============ è·¨é“¾çŠ¶æ€æšä¸¾ ============
enum CrossChainStatus {
  LOCKING          // é”å®šä¸­
  LOCKED           // å·²é”å®š
  CROSSING_OUT     // è·¨é“¾å‡ºå‘ä¸­
  ON_TARGET_CHAIN  // åœ¨ç›®æ ‡é“¾ä¸Š
  CROSSING_BACK    // è·¨é“¾è¿”å›ä¸­
  UNLOCKING        // è§£é”ä¸­
  COMPLETED        // å®Œæˆ
  TIMEOUT          // è¶…æ—¶
  FAILED           // å¤±è´¥
}

// ============ è·¨é“¾æ¶ˆæ¯æ¨¡å‹ ============
model CrossChainMessage {
  id              Int                @id @default(autoincrement())
  messageId       String             @unique    // è·¨é“¾æ¶ˆæ¯å”¯ä¸€ID (bytes32)
  tokenId         Int                           // é’è›™ tokenId
  sourceChain     ChainType
  targetChain     ChainType
  direction       MessageDirection              // OUT / BACK
  status          CrossChainMessageStatus       // PENDING / CONFIRMED / FAILED
  sendTxHash      String?
  receiveTxHash   String?
  payload         Json                          // æ¶ˆæ¯å†…å®¹
  gasUsed         String?
  sentAt          DateTime
  confirmedAt     DateTime?
  createdAt       DateTime           @default(now())
  
  @@index([tokenId])
  @@index([status])
  @@index([messageId])
}

enum MessageDirection {
  OUT   // ä»ä¸»é“¾åˆ°ç›®æ ‡é“¾
  BACK  // ä»ç›®æ ‡é“¾è¿”å›ä¸»é“¾
}

enum CrossChainMessageStatus {
  PENDING
  CONFIRMED
  FAILED
  TIMEOUT
}


enum ImageGenerationStatus {
  PENDING
  GENERATING
  PROCESSING
  UPLOADING
  COMPLETED
  FAILED
}

enum FriendshipStatus {
  Pending
  Accepted
  Declined
  Blocked
}

enum InteractionType {
  Visit
  Feed
  Play
  Gift
  Message
  Travel
}

enum DiaryMood {
  HAPPY
  CURIOUS
  SURPRISED
  PEACEFUL
  EXCITED
  SLEEPY
}

enum BadgeUnlockType {
  TRIP_COUNT
  CHAIN_VISIT
  MULTI_CHAIN
  RARE_FIND
  SPECIAL
  SOCIAL      // ç¤¾äº¤äº’åŠ¨ç±»å¾½ç« 
  COLLECTION  // æ”¶è—æˆå°±ç±»å¾½ç« 
}

// ============ æ–°å¢ï¼šèŠå¤©ç›¸å…³ ============

// èŠå¤©ä¼šè¯
model ChatSession {
  id           Int           @id @default(autoincrement())
  frogId       Int
  ownerAddress String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  frog         Frog          @relation(fields: [frogId], references: [id])
  messages     ChatMessage[]
  
  @@index([ownerAddress])
  @@index([frogId])
}

// èŠå¤©æ¶ˆæ¯
model ChatMessage {
  id           Int           @id @default(autoincrement())
  sessionId    Int
  role         MessageRole   // user | assistant
  content      String        @db.Text
  intent       ChatIntent?   // è¯†åˆ«å‡ºçš„æ„å›¾
  intentParams Json?         // æ„å›¾å‚æ•°
  createdAt    DateTime      @default(now())
  
  session      ChatSession   @relation(fields: [sessionId], references: [id])
  
  @@index([sessionId])
}

// ä»·æ ¼ç¼“å­˜ï¼ˆå‡å°‘ API è°ƒç”¨ï¼‰
model PriceCache {
  id           Int      @id @default(autoincrement())
  symbol       String   // ETH, BTC, ZETA...
  priceUsd     Float
  change24h    Float?   // 24h æ¶¨è·Œå¹…
  source       String   // coingecko, dexscreener...
  updatedAt    DateTime @updatedAt
  
  @@unique([symbol, source])
  @@index([symbol])
}

// ç”¨æˆ·èµ„äº§å¿«ç…§ï¼ˆå¯é€‰ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢ï¼‰
model AssetSnapshot {
  id           Int      @id @default(autoincrement())
  ownerAddress String
  chainId      Int
  assets       Json     // { tokens: [...], nfts: [...], totalValueUsd: ... }
  updatedAt    DateTime @updatedAt
  
  @@unique([ownerAddress, chainId])
  @@index([ownerAddress])
}

// ============ æ–°å¢æšä¸¾ ============

enum MessageRole {
  user
  assistant
}

enum ChatIntent {
  // åŸºç¡€æŸ¥è¯¢
  price_query      // ä»·æ ¼æŸ¥è¯¢
  asset_query      // èµ„äº§æŸ¥è¯¢
  frog_status      // é’è›™çŠ¶æ€
  
  // æ—…è¡Œç³»ç»Ÿ
  travel_info      // æ—…è¡Œä¿¡æ¯/å†å²
  start_travel     // å¼€å§‹æ—…è¡Œ
  travel_stats     // æ—…è¡Œç»Ÿè®¡
  
  // å¥½å‹ç³»ç»Ÿ
  friend_list      // æŸ¥çœ‹å¥½å‹åˆ—è¡¨
  friend_add       // æ·»åŠ å¥½å‹
  friend_visit     // æ‹œè®¿å¥½å‹å®¶å›­
  
  // æ”¶è—ç³»ç»Ÿ
  souvenirs_query  // æŸ¥çœ‹çºªå¿µå“
  badges_query     // æŸ¥çœ‹å¾½ç« 
  
  // å®¶å›­ç³»ç»Ÿ
  garden_query     // æŸ¥çœ‹å®¶å›­
  messages_query   // æŸ¥çœ‹ç•™è¨€
  
  // é€šç”¨
  chitchat         // é—²èŠ
  help             // å¸®åŠ©
  navigate         // å¯¼èˆªåˆ°é¡µé¢
  unknown          // æœªè¯†åˆ«
}

enum Personality {
  PHILOSOPHER  // å“²å­¦å®¶ï¼šæ·±æ²‰ã€çˆ±æ€è€ƒ
  COMEDIAN     // æ®µå­æ‰‹ï¼šåæ§½ã€æç¬‘
  POET         // è¯—äººï¼šæµªæ¼«ã€æ–‡è‰º
  GOSSIP       // å…«å¦è›™ï¼šçˆ±æ‰“å¬ã€çˆ±çˆ†æ–™
}

// ============ ç»“ä¼´æ—…è¡Œ ============

model GroupTravel {
  id          Int               @id @default(autoincrement())
  leaderId    Int               // å‘èµ·è€…é’è›™ ID
  companionId Int               // åŒä¼´é’è›™ ID
  travelId    Int               @unique
  status      GroupTravelStatus @default(ACTIVE)
  createdAt   DateTime          @default(now())
  
  leader      Frog              @relation("GroupTravelLeader", fields: [leaderId], references: [id])
  companion   Frog              @relation("GroupTravelCompanion", fields: [companionId], references: [id])
  travel      Travel            @relation(fields: [travelId], references: [id])
  
  @@index([leaderId])
  @@index([companionId])
  @@index([status])
}

enum GroupTravelStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

// ============ ä¸²é—¨ç•™è¨€ (å¢å¼ºç‰ˆ) ============

model VisitorMessage {
  id          Int      @id @default(autoincrement())
  fromFrogId  Int      // è®¿é—®è€…é’è›™
  toAddress   String   // è¢«è®¿é—®åœ°å€ (ç”¨æˆ·é’±åŒ…)
  message     String   // ç•™è¨€å†…å®¹
  travelId    Int?     // å…³è”æ—…è¡Œ (å¯é€‰)
  emoji       String?  // è¡¨æƒ…ç¬¦å·
  isRead      Boolean  @default(false) // æ˜¯å¦å·²è¯»
  createdAt   DateTime @default(now())
  
  // ğŸ†• Web3 å¢å¼º
  signature   String?  // é’±åŒ…ç­¾å (EIP-712)
  tipAmount   String?  // æ‰“èµé‡‘é¢ (wei)
  tipTxHash   String?  // æ‰“èµäº¤æ˜“å“ˆå¸Œ
  likesCount  Int      @default(0)
  likedBy     String[] @default([]) // ç‚¹èµè€…åœ°å€åˆ—è¡¨
  
  fromFrog    Frog     @relation(fields: [fromFrogId], references: [id])
  travel      Travel?  @relation(fields: [travelId], references: [id])
  
  @@index([toAddress])
  @@index([fromFrogId])
  @@index([isRead])
}

// ============ å®¶å›­è£…é¥°ç³»ç»Ÿ ============

// è£…é¥°å“å…ƒæ•°æ® (å…¨å±€å®šä¹‰)
model Decoration {
  id            String           @id @default(cuid())
  name          String
  type          DecorationType
  assetUrl      String           // å›¾ç‰‡èµ„æº URL
  layer         Int              @default(0) // é»˜è®¤å±‚çº§åŸºå‡†
  isInteractive Boolean          @default(false)
  width         Int              @default(64) // é»˜è®¤å®½åº¦ (åƒç´ )
  height        Int              @default(64) // é»˜è®¤é«˜åº¦ (åƒç´ )
  createdAt     DateTime         @default(now())
  
  userDecorations UserDecoration[]
}

enum DecorationType {
  FURNITURE        // å®¶å…·
  PLANT            // æ¤ç‰©
  FLOORING         // åœ°æ¿
  WALLPAPER        // å£çº¸
  SOUVENIR_DISPLAY // çºªå¿µå“å±•ç¤ºæ¶
}

// ç”¨æˆ·æ‹¥æœ‰çš„è£…é¥°å“åº“å­˜
model UserDecoration {
  id           String       @id @default(cuid())
  frogId       Int          // æ‹¥æœ‰è€…
  decorationId String
  amount       Int          @default(1)
  
  // å¦‚æœæ­¤è£…é¥°å“ä»£è¡¨ç‰¹å®šçš„çºªå¿µå“ NFT
  souvenirId   Int?         @unique
  
  createdAt    DateTime     @default(now())
  
  decoration   Decoration   @relation(fields: [decorationId], references: [id])
  frog         Frog         @relation(fields: [frogId], references: [id])
  placements   PlacedItem[]
  
  @@index([frogId])
  @@index([decorationId])
}

// å¸ƒå±€é…ç½® (æ¯ä¸ªé’è›™æ¯ä¸ªåœºæ™¯ä¸€ä¸ª)
model RoomLayout {
  id        String       @id @default(cuid())
  frogId    Int
  sceneType String       // 'yard' (åº­é™¢) | 'indoor' (å®¤å†…)
  version   Int          @default(1) // ç‰ˆæœ¬æ§åˆ¶
  updatedAt DateTime     @updatedAt
  createdAt DateTime     @default(now())
  
  items     PlacedItem[]
  snapshots RoomLayoutSnapshot[]
  frog      Frog         @relation(fields: [frogId], references: [id])
  
  @@unique([frogId, sceneType])
  @@index([frogId])
}

// ç‰©å“å…·ä½“æ‘†æ”¾ä½ç½®
model PlacedItem {
  id               String         @id @default(cuid())
  layoutId         String
  userDecorationId String
  x                Float          // ç™¾åˆ†æ¯” 0-100
  y                Float          // ç™¾åˆ†æ¯” 0-100
  scale            Float          @default(1.0)
  rotation         Int            @default(0)
  zIndex           Int            @default(1)
  createdAt        DateTime       @default(now())
  
  layout           RoomLayout     @relation(fields: [layoutId], references: [id], onDelete: Cascade)
  userDecoration   UserDecoration @relation(fields: [userDecorationId], references: [id])
  
  @@index([layoutId])
  @@index([userDecorationId])
}

// å¸ƒå±€å¿«ç…§ (å†å²ç‰ˆæœ¬)
model RoomLayoutSnapshot {
  id        String     @id @default(cuid())
  layoutId  String
  items     Json       // å¿«ç…§æ—¶çš„ items çŠ¶æ€
  createdAt DateTime   @default(now())
  
  layout    RoomLayout @relation(fields: [layoutId], references: [id], onDelete: Cascade)
  
  @@index([layoutId])
}

// ============ ç¤¼ç‰©ç³»ç»Ÿ ============

model Gift {
  id            String   @id @default(cuid())
  fromAddress   String   // å‘é€è€…é’±åŒ…
  toFrogId      Int      // æ¥æ”¶è€…é’è›™
  giftType      GiftType
  
  // ç‰©å“è¯¦æƒ…
  itemName      String
  itemImageUrl  String?
  quantity      Int      @default(1)
  
  // NFT ç¤¼ç‰© (å¯é€‰)
  nftContract   String?  // NFT åˆçº¦åœ°å€
  nftTokenId    String?  // Token ID
  
  // é“¾ä¸Šè¿½è¸ª
  txHash        String?
  
  isOpened      Boolean  @default(false)
  message       String?  // é™„è¨€
  createdAt     DateTime @default(now())
  openedAt      DateTime?
  
  toFrog        Frog     @relation(fields: [toFrogId], references: [id])
  
  @@index([toFrogId])
  @@index([fromAddress])
  @@index([isOpened])
}

enum GiftType {
  ITEM        // æ™®é€šç‰©å“ (é£Ÿç‰©ã€ç©å…·)
  NFT         // NFT æ”¶è—å“
  TOKEN       // ä»£å¸
  DECORATION  // è£…é¥°å“
}

// ============ ç›¸å†Œç³»ç»Ÿ ============

model Photo {
  id            String   @id @default(cuid())
  frogId        Int
  travelId      Int?
  
  // å›¾ç‰‡ä¿¡æ¯
  imageUrl      String   // æœ¬åœ°/CDN URL
  ipfsHash      String?  // IPFS CID
  ipfsUrl       String?  // IPFS ç½‘å…³ URL
  
  // NFT é“¸é€ 
  isNft         Boolean  @default(false)
  nftContract   String?
  nftTokenId    String?
  mintTxHash    String?
  
  // å…ƒæ•°æ®
  caption       String?
  location      String?  // æ‹æ‘„åœ°ç‚¹ (é“¾å/åœ°å€ç®€ç§°)
  takenAt       DateTime @default(now())
  
  // äº’åŠ¨
  likesCount    Int      @default(0)
  
  frog          Frog     @relation(fields: [frogId], references: [id])
  travel        Travel?  @relation(fields: [travelId], references: [id])
  
  @@index([frogId])
  @@index([travelId])
}

// ============ æˆå°±ç³»ç»Ÿ (æ‰©å±•) ============

enum AchievementCategory {
  TRAVEL      // æ—…è¡Œæˆå°±
  SOCIAL      // ç¤¾äº¤æˆå°± (ç•™è¨€ã€ç¤¼ç‰©)
  COLLECTION  // æ”¶è—æˆå°± (çºªå¿µå“ã€ç›¸å†Œ)
  DECORATION  // è£…é¥°æˆå°±
  CROSSCHAIN  // ğŸ†• è·¨é“¾æˆå°±
}

model Achievement {
  id             String              @id @default(cuid())
  code           String              @unique
  name           String
  description    String
  icon           String
  category       AchievementCategory
  rarity         Int                 @default(1) // 1-5
  condition      Json                // è§£é”æ¡ä»¶
  
  // SBT é…ç½®
  isSbt          Boolean             @default(false)
  sbtContract    String?
  sbtMetadataUri String?
  
  isHidden       Boolean             @default(false)
  createdAt      DateTime            @default(now())
  
  earnedBy       EarnedAchievement[]
}

model EarnedAchievement {
  id            String      @id @default(cuid())
  frogId        Int
  achievementId String
  earnedAt      DateTime    @default(now())
  
  // SBT é“¸é€ è®°å½•
  sbtTokenId    String?
  sbtTxHash     String?
  
  frog          Frog        @relation(fields: [frogId], references: [id])
  achievement   Achievement @relation(fields: [achievementId], references: [id])
  
  @@unique([frogId, achievementId])
  @@index([frogId])
  @@index([achievementId])
}

// ============ ğŸ†• è·¨é“¾è½¬è´¦æ¨¡å— ============

model CrossChainTransfer {
  id             String    @id @default(cuid())
  fromFrogId     Int
  fromAddress    String
  toAddress      String
  toFrogId       Int?      // å¦‚æœæ˜¯å¥½å‹è½¬è´¦
  
  amount         String    // è½¬è´¦é‡‘é¢
  tokenSymbol    String    // ZETA, ETH, BNB ç­‰
  sourceChain    String    // æºé“¾
  targetChain    String    // ç›®æ ‡é“¾
  message        String?   // è½¬è´¦é™„è¨€
  
  // äº¤æ˜“çŠ¶æ€
  status         String    @default("PENDING") // PENDING, CONFIRMING, COMPLETED, FAILED
  sourceTxHash   String?   // æºé“¾äº¤æ˜“å“ˆå¸Œ
  cctxHash       String?   // ZetaChain CCTX å“ˆå¸Œ
  targetTxHash   String?   // ç›®æ ‡é“¾äº¤æ˜“å“ˆå¸Œ
  
  createdAt      DateTime  @default(now())
  confirmedAt    DateTime?
  
  fromFrog       Frog      @relation("TransfersSent", fields: [fromFrogId], references: [id])
  toFrog         Frog?     @relation("TransfersReceived", fields: [toFrogId], references: [id])
  
  @@index([fromFrogId])
  @@index([toFrogId])
  @@index([fromAddress])
  @@index([toAddress])
  @@index([status])
}

// ============ ğŸ†• ç¤¾åŒºç³»ç»Ÿ ============

// ç¤¾åŒºå‡­è¯ç±»å‹
enum CommunityCredentialType {
  PUBLIC       // å…¬å¼€ç¤¾åŒºï¼Œæ— éœ€å‡­è¯
  NFT          // éœ€æŒæœ‰ç‰¹å®š NFT
  INVITE_CODE  // éœ€è¦é‚€è¯·ç 
  SIGNATURE    // éœ€è¦ç­¾åéªŒè¯
}

// ç¤¾åŒºå®šä¹‰
model Community {
  id               String                   @id @default(cuid())
  name             String
  icon             String                   @default("ğŸ ")
  themeColor       String                   @default("#4CAF50")
  description      String?
  
  // å‡­è¯é…ç½®
  credentialType   CommunityCredentialType  @default(PUBLIC)
  credentialData   Json?                    // NFT åˆçº¦åœ°å€ã€é‚€è¯·ç åˆ—è¡¨ç­‰
  
  // ç»Ÿè®¡
  memberCount      Int                      @default(0)
  
  // ç®¡ç†
  creatorAddress   String?
  isOfficial       Boolean                  @default(false)
  isActive         Boolean                  @default(true)
  
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime                 @updatedAt
  
  members          UserCommunity[]
  
  @@index([name])
  @@index([creatorAddress])
  @@index([isActive])
}

// ç”¨æˆ·åŠ å…¥çš„ç¤¾åŒº
model UserCommunity {
  id           Int       @id @default(autoincrement())
  userAddress  String    // ç”¨æˆ·é’±åŒ…åœ°å€
  communityId  String
  
  // åŠ å…¥å‡­è¯
  credential   String?   // ä½¿ç”¨çš„å‡­è¯ï¼ˆé‚€è¯·ç ã€NFT token ID ç­‰ï¼‰
  
  // çŠ¶æ€
  isActive     Boolean   @default(false)  // æ˜¯å¦ä¸ºå½“å‰æ¿€æ´»ç¤¾åŒº
  
  joinedAt     DateTime  @default(now())
  
  community    Community @relation(fields: [communityId], references: [id])
  
  @@unique([userAddress, communityId])
  @@index([userAddress])
  @@index([communityId])
  @@index([isActive])
}

